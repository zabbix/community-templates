<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>5.0</version><date>2021-11-21T21:46:38Z</date><groups><group><name>LSI</name></group></groups><templates><template><template>LSI JSON discovery</template><name>LSI JSON discovery</name><description>## Overview

Description
-----------


This template is for discovering and monitoring LSI (Avago, Broadcom) storage controllers by using json outputs of storcli tool. Now it works only with zabbix 4.2


Main features
-------------


* Discovery of controllers, logical discs, physical discs, batteries (bbu an cv) without scripts on servers side (it uses parsing of json and java scripts on zabbix side)
* Monitoring controllers, logical, physical discs, batteries
* Useful with OS, where storcli works
* Comfortable changing of time intervals by macroses.


Notes
-----


* Please follow link for the newest version and instruction

&lt;

</description><groups><group><name>LSI</name></group></groups><applications><application><name>LSI battery</name></application><application><name>LSI controllers</name></application><application><name>LSI Internal items</name></application><application><name>LSI Logical disks</name></application><application><name>LSI Physical disks</name></application></applications><items><item><name>All bbus info</name><key>lsi.bbusinfo</key><delay>{$ADAP_REQUEST_PERIOD}</delay><history>{$INTERNAL_ITEMS_HISTORY_PEIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Internal items</name></application></applications></item><item><name>All Ctls info</name><key>lsi.ctlsinfo</key><delay>{$ADAP_REQUEST_PERIOD}</delay><history>{$INTERNAL_ITEMS_HISTORY_PEIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Internal items</name></application></applications></item><item><name>All cvs info</name><key>lsi.cvsinfo</key><delay>{$ADAP_REQUEST_PERIOD}</delay><history>{$INTERNAL_ITEMS_HISTORY_PEIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Internal items</name></application></applications></item><item><name>All Lds info</name><key>lsi.ldsinfo</key><delay>{$LD_REQUEST_PERIOD}</delay><history>{$INTERNAL_ITEMS_HISTORY_PEIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Internal items</name></application></applications></item><item><name>All Pds info</name><key>lsi.pdsinfo</key><delay>{$PD_REQUEST_PERIOD}</delay><history>{$INTERNAL_ITEMS_HISTORY_PEIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Internal items</name></application></applications></item></items><discovery_rules><discovery_rule><name>Controllers discovery</name><key>lsi.ctllld</key><delay>{$ADAP_DISCOVERY_PERIOD}</delay><item_prototypes><item_prototype><name>Controller &quot;{#CTLID}&quot; cache bbu data</name><type>DEPENDENT</type><key>lsi.ctl.bbu.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Internal items</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][{#CTLID}]</params></step><step><type>CHECK_REGEX_ERROR</type><params>(&quot;Status&quot;\s:\s&quot;Failure&quot;)
\1</params></step><step><type>JSONPATH</type><params>$['Response Data']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.bbusinfo</key></master_item></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; bbu low charge level</name><type>DEPENDENT</type><key>lsi.ctl.bbulowcharge.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI battery</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['BBU_Firmware_Status'][10]['Value']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctl.bbu.[&quot;{#CTLID}&quot;]</key></master_item><trigger_prototypes><trigger_prototype><expression>{str(No)}=0 and {strlen()}&gt;0</expression><name>LSI controller {#CTLID} battery charge level is low</name><priority>AVERAGE</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; bbu need to replace</name><type>DEPENDENT</type><key>lsi.ctl.bbureplace.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI battery</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['BBU_Firmware_Status'][9]['Value']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctl.bbu.[&quot;{#CTLID}&quot;]</key></master_item><trigger_prototypes><trigger_prototype><expression>({str(No)}=0 and {strlen()}&gt;0)</expression><name>LSI controller {#CTLID} bbu battery is need to be replaced</name><priority>AVERAGE</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; bbu serial number</name><type>DEPENDENT</type><key>lsi.ctl.bbusn.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI battery</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['BBU_Design_Info'][4]['Value']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctl.bbu.[&quot;{#CTLID}&quot;]</key></master_item><trigger_prototypes><trigger_prototype><expression>({diff()}=1 and {strlen()}&gt;0)</expression><recovery_mode>NONE</recovery_mode><name>LSI controller {#CTLID} bbu battery was replaced</name><priority>INFO</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; bbu state</name><type>DEPENDENT</type><key>lsi.ctl.bbustate.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI battery</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['BBU_Info'][4]['Value']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctl.bbu.[&quot;{#CTLID}&quot;]</key></master_item><trigger_prototypes><trigger_prototype><expression>({str(Optimal)}=0 and {strlen()}&gt;0)</expression><name>LSI controller {#CTLID} bbu battery state is {ITEM.LASTVALUE}</name><priority>AVERAGE</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; bbu type</name><type>DEPENDENT</type><key>lsi.ctl.bbutype.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI battery</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['BBU_Info'][0]['Value']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctl.bbu.[&quot;{#CTLID}&quot;]</key></master_item></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; cache vault data</name><type>DEPENDENT</type><key>lsi.ctl.cvdata.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Internal items</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][{#CTLID}]</params></step><step><type>CHECK_REGEX_ERROR</type><params>(&quot;Status&quot;\s:\s&quot;Failure&quot;)
\1</params></step><step><type>JSONPATH</type><params>$['Response Data']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.cvsinfo</key></master_item></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; cache vault need to replace</name><type>DEPENDENT</type><key>lsi.ctl.cvreplace.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI battery</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Firmware_Status'][0]['Value']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctl.cvdata.[&quot;{#CTLID}&quot;]</key></master_item><trigger_prototypes><trigger_prototype><expression>({str(No)}=0 and {strlen()}&gt;0)</expression><name>LSI controller {#CTLID} cachevault battery is need to be replaced</name><priority>AVERAGE</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; cache vault serial number</name><type>DEPENDENT</type><key>lsi.ctl.cvsn.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI battery</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Design_Info'][1]['Value']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctl.cvdata.[&quot;{#CTLID}&quot;]</key></master_item><trigger_prototypes><trigger_prototype><expression>({diff()}=1 and {strlen()}&gt;0)</expression><recovery_mode>NONE</recovery_mode><name>LSI controller {#CTLID} cachevault battery was replaced</name><priority>INFO</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; cache vault state</name><type>DEPENDENT</type><key>lsi.ctl.cvstate.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI battery</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Cachevault_Info'][2]['Value']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctl.cvdata.[&quot;{#CTLID}&quot;]</key></master_item><trigger_prototypes><trigger_prototype><expression>({str(Optimal)}=0 and {strlen()}&gt;0)</expression><name>LSI controller {#CTLID} cachevault battery state is {ITEM.LASTVALUE}</name><priority>AVERAGE</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; cache vault type</name><type>DEPENDENT</type><key>lsi.ctl.cvtype.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI battery</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Cachevault_Info'][0]['Value']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctl.cvdata.[&quot;{#CTLID}&quot;]</key></master_item></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; model</name><type>DEPENDENT</type><key>lsi.ctl.model.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI controllers</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][{#CTLID}]['Response Data']['Basics']['Model']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctlsinfo</key></master_item></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; serial number</name><type>DEPENDENT</type><key>lsi.ctl.sn.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI controllers</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][{#CTLID}]['Response Data']['Basics']['Serial Number']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctlsinfo</key></master_item><trigger_prototypes><trigger_prototype><expression>{diff()}=1 and {strlen()}&gt;0</expression><recovery_mode>NONE</recovery_mode><name>LSI controller {#CTLID} was replaced</name><priority>INFO</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Controller &quot;{#CTLID}&quot; state (health)</name><type>DEPENDENT</type><key>lsi.ctl.state.[&quot;{#CTLID}&quot;]</key><delay>0</delay><history>{$ADAP_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI controllers</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][{#CTLID}]['Response Data']['Status']['Controller Status']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ctlsinfo</key></master_item><trigger_prototypes><trigger_prototype><expression>{str(Opt)}=0</expression><recovery_mode>RECOVERY_EXPRESSION</recovery_mode><recovery_expression>{str(Opt)}=1</recovery_expression><name>LSI controller {#CTLID} status is {ITEM.LASTVALUE}</name><priority>HIGH</priority><tags><tag><tag>RAID_CTL_STATE</tag><value>{ITEM.LASTVALUE}</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype></item_prototypes><lld_macro_paths><lld_macro_path><lld_macro>{#CTLID}</lld_macro><path>$.Ctl</path></lld_macro_path></lld_macro_paths><preprocessing><step><type>CHECK_JSON_ERROR</type><params>$['Controllers'][0]['Command Status']['Detailed Status'][0]['ErrMsg']</params></step><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['System Overview']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$ADAP_THROTTLING_HB_PERIOD}</params></step></preprocessing></discovery_rule><discovery_rule><name>Logical disks discovery</name><key>lsi.ldlld</key><delay>{$LD_DISCOVERY_PERIOD}</delay><item_prototypes><item_prototype><name>Logical disk &quot;{#LDNAME}&quot; (id {#LDID}) level</name><type>DEPENDENT</type><key>lsi.ld.level.[&quot;{#LDID}&quot;]</key><delay>0</delay><history>{$LD_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Logical disks</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['{#LDID}'][0]['TYPE']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$LD_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.ldsinfo</key></master_item></item_prototype><item_prototype><name>Logical disk &quot;{#LDNAME}&quot; (id {#LDID})  state</name><type>DEPENDENT</type><key>lsi.ld.state.[&quot;{#LDID}&quot;]</key><delay>0</delay><history>{$LD_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Logical disks</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['{#LDID}'][0]['State']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$LD_THROTTLING_HB_PERIOD}</params></step><step><type>JAVASCRIPT</type><params>switch(value)
{
case 'Optl':
value='Optimal';
break;
case 'OfLn':
value='Offline';
break;
case 'Pdgd':
value='Partially degraded';
break;
case 'Dgrd':
value='Degraded';
break;
}
return value</params></step></preprocessing><master_item><key>lsi.ldsinfo</key></master_item><trigger_prototypes><trigger_prototype><expression>{str(Optimal)}=0</expression><recovery_mode>RECOVERY_EXPRESSION</recovery_mode><recovery_expression>{str(Optimal)}=1</recovery_expression><name>LSI logical disk &quot;{#LDNAME}&quot; (&quot;{#LDID}&quot;) state is &quot;{ITEM.LASTVALUE}&quot;</name><priority>HIGH</priority><tags><tag><tag>LD STATE</tag><value>{ITEM.LASTVALUE}</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype></item_prototypes><lld_macro_paths><lld_macro_path><lld_macro>{#LDID}</lld_macro><path>$.LDID</path></lld_macro_path><lld_macro_path><lld_macro>{#LDNAME}</lld_macro><path>$.Name</path></lld_macro_path></lld_macro_paths><preprocessing><step><type>JAVASCRIPT</type><params>var JsonValue = JSON.parse(value);
var ResponseStatus=JsonValue.Controllers[0]['Command Status']['Status'];
var TxtValue='';
if (ResponseStatus.match(/Success/g)) {
var ResponseData = JsonValue.Controllers[0]['Response Data'];
var NeedData = [];
var i=0;
for (var key in ResponseData) {
	if (key.match(/\/c\d{1,}\/v\d{1,}/g)) {
		 JsonValue.Controllers[0]['Response Data'][key][0]['LDID'] = key;
		 NeedData[i] = JsonValue.Controllers[0]['Response Data'][key][0];
		 i = i + 1;
	}
}
TxtValue = JSON.stringify(NeedData);
}
else {
TxtValue = JsonValue.Controllers[0]['Command Status']['Description'];
}
return TxtValue</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$LD_THROTTLING_HB_PERIOD}</params></step></preprocessing></discovery_rule><discovery_rule><name>Physical disks discovery</name><key>lsi.pdlld</key><delay>{$PD_DISCOVERY_PERIOD}</delay><item_prototypes><item_prototype><name>Physical disk &quot;{#PDID}&quot; media error count</name><type>DEPENDENT</type><key>lsi.pd.merrcount.[&quot;{#PDID}&quot;]</key><delay>0</delay><history>{$PD_HISTORY_PERIOD}</history><trends>{$PD_TRENDS_PERIOD}</trends><applications><application><name>LSI Physical disks</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['Drive {#PDID} - Detailed Information']['Drive {#PDID} State']['Media Error Count']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$PD_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.pdsinfo</key></master_item><trigger_prototypes><trigger_prototype><expression>{last()}&gt;0</expression><recovery_mode>RECOVERY_EXPRESSION</recovery_mode><recovery_expression>{last()}=0</recovery_expression><name>LSI physical disk &quot;{#PDID}&quot; media error count is &quot;{ITEM.LASTVALUE}&quot;</name><priority>AVERAGE</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Physical disk &quot;{#PDID}&quot; model</name><type>DEPENDENT</type><key>lsi.pd.model.[&quot;{#PDID}&quot;]</key><delay>0</delay><history>{$PD_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Physical disks</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['Drive {#PDID}'][0]['Model']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$PD_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.pdsinfo</key></master_item></item_prototype><item_prototype><name>Physical disk &quot;{#PDID}&quot; other error count</name><type>DEPENDENT</type><key>lsi.pd.otherrcount.[&quot;{#PDID}&quot;]</key><delay>0</delay><history>{$PD_HISTORY_PERIOD}</history><trends>{$PD_TRENDS_PERIOD}</trends><applications><application><name>LSI Physical disks</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['Drive {#PDID} - Detailed Information']['Drive {#PDID} State']['Other Error Count']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$PD_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.pdsinfo</key></master_item></item_prototype><item_prototype><name>Physical disk &quot;{#PDID}&quot; predictive failure count</name><type>DEPENDENT</type><key>lsi.pd.predicterrcount.[&quot;{#PDID}&quot;]</key><delay>0</delay><history>{$PD_HISTORY_PERIOD}</history><trends>{$PD_TRENDS_PERIOD}</trends><applications><application><name>LSI Physical disks</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['Drive {#PDID} - Detailed Information']['Drive {#PDID} State']['Predictive Failure Count']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$PD_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.pdsinfo</key></master_item><trigger_prototypes><trigger_prototype><expression>{last()}&gt;0</expression><recovery_mode>RECOVERY_EXPRESSION</recovery_mode><recovery_expression>{last()}=0</recovery_expression><name>LSI physical disk &quot;{#PDID}&quot; predictive failure count is &quot;{ITEM.LASTVALUE}&quot;</name><priority>WARNING</priority><manual_close>YES</manual_close></trigger_prototype><trigger_prototype><expression>{last()}&gt;0 and {diff()}=1</expression><recovery_mode>RECOVERY_EXPRESSION</recovery_mode><recovery_expression>{last()}=0</recovery_expression><name>LSI physical disk &quot;{#PDID}&quot; predictive failure count is &quot;{ITEM.LASTVALUE}&quot;. Growing up</name><priority>WARNING</priority><manual_close>YES</manual_close><dependencies><dependency><name>LSI physical disk &quot;{#PDID}&quot; predictive failure count is &quot;{ITEM.LASTVALUE}&quot;</name><expression>{LSI JSON discovery:lsi.pd.predicterrcount.[&quot;{#PDID}&quot;].last()}&gt;0</expression><recovery_expression>{LSI JSON discovery:lsi.pd.predicterrcount.[&quot;{#PDID}&quot;].last()}=0</recovery_expression></dependency></dependencies></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Physical disk &quot;{#PDID}&quot; SMART flag</name><type>DEPENDENT</type><key>lsi.pd.smartflag.[&quot;{#PDID}&quot;]</key><delay>0</delay><history>{$PD_HISTORY_PERIOD}</history><trends>0</trends><value_type>CHAR</value_type><applications><application><name>LSI Physical disks</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['Drive {#PDID} - Detailed Information']['Drive {#PDID} State']['S.M.A.R.T alert flagged by drive']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$PD_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.pdsinfo</key></master_item><trigger_prototypes><trigger_prototype><expression>{str(Yes)}=1</expression><recovery_mode>RECOVERY_EXPRESSION</recovery_mode><recovery_expression>{str(No)}=1</recovery_expression><name>LSI physical disk: SMART flag was raised up on &quot;{#PDID}&quot;</name><priority>AVERAGE</priority><manual_close>YES</manual_close><tags><tag><tag>PD SMART</tag><value>{ITEM.LASTVALUE}</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Physical disk &quot;{#PDID}&quot; serial number</name><type>DEPENDENT</type><key>lsi.pd.sn.[&quot;{#PDID}&quot;]</key><delay>0</delay><history>{$PD_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Physical disks</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['Drive {#PDID} - Detailed Information']['Drive {#PDID} Device attributes']['SN']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$PD_THROTTLING_HB_PERIOD}</params></step></preprocessing><master_item><key>lsi.pdsinfo</key></master_item><trigger_prototypes><trigger_prototype><expression>{diff()}=1 and {strlen(#2)}&gt;0</expression><recovery_mode>NONE</recovery_mode><name>LSI physical disk &quot;{#PDID}&quot; was replaced by sn  &quot;{ITEM.LASTVALUE1}&quot;.  Previous sn: &quot;{ITEM.LASTVALUE2}&quot;</name><priority>INFO</priority><manual_close>YES</manual_close><tags><tag><tag>PD REPLACE</tag><value>{ITEM.LASTVALUE1}</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Physical disk &quot;{#PDID}&quot; state</name><type>DEPENDENT</type><key>lsi.pd.state.[&quot;{#PDID}&quot;]</key><delay>0</delay><history>{$PD_HISTORY_PERIOD}</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>LSI Physical disks</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$['Controllers'][0]['Response Data']['Drive {#PDID}'][0]['State']</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$PD_THROTTLING_HB_PERIOD}</params></step><step><type>JAVASCRIPT</type><params>switch(value)
{
case 'Onln':
value='Online';
break;
case 'Ugood':
value='Unconfigured-Good';
break;
case 'Ubad':
value='Unconfigured-Bad';
break;
case 'Msng':
value='Missing';
break;
case 'Offln':
value='Offline';
break;
case 'F':
value='Foreign';
break;
case 'GHS':
value='Global Hot Spare';
break;
case 'DHS':
value='Dedicated Hot Spare';
break;
case 'Rbld':
value='Rebuild';
break;
}
return value</params></step></preprocessing><master_item><key>lsi.pdsinfo</key></master_item><trigger_prototypes><trigger_prototype><expression>({str(Unconfigured-Bad)}=1 or {str(Unconfigured-Good)}=1 or {str(Missing)}=1 or {str(Offline)}=1 or {str(Foreign)}=1) and {diff()}=1 and {strlen()}&gt;0</expression><recovery_mode>RECOVERY_EXPRESSION</recovery_mode><recovery_expression>{str(Unconfigured-Good)}=1 or {str(Online)}=1</recovery_expression><name>LSI physical disk &quot;{#PDID}&quot; is &quot;{ITEM.LASTVALUE}&quot;</name><priority>HIGH</priority><manual_close>YES</manual_close><tags><tag><tag>PD STATE</tag><value>{ITEM.LASTVALUE}</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype></item_prototypes><lld_macro_paths><lld_macro_path><lld_macro>{#PDID}</lld_macro><path>$.PDID</path></lld_macro_path></lld_macro_paths><preprocessing><step><type>JAVASCRIPT</type><params>var JsonValue = JSON.parse(value);
var ResponseStatus=JsonValue.Controllers[0]['Command Status']['Status'];
var TxtValue='';
if (ResponseStatus.match(/Success/g)) {
var ResponseData = JsonValue.Controllers[0]['Response Data'];
var NeedData = [];
var i=0;
for (var key in ResponseData) {
	var KeySplitted = key.split(' ');
	if (KeySplitted.length === 2) {
		 JsonValue.Controllers[0]['Response Data'][key][0]['PDID'] = KeySplitted[1];
		 NeedData[i] = JsonValue.Controllers[0]['Response Data'][key][0];
		 i = i + 1;
	}
}
TxtValue = JSON.stringify(NeedData);
}
else{
TxtValue = JsonValue.Controllers[0]['Description'];
}
return TxtValue</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>{$PD_THROTTLING_HB_PERIOD}</params></step></preprocessing></discovery_rule></discovery_rules><macros><macro><macro>{$ADAP_THROTTLING_HB_PERIOD}</macro><value>10800</value></macro><macro><macro>{$INTERNAL_ITEMS_HISTORY_PEIOD}</macro><value>0</value></macro><macro><macro>{$LD_THROTTLING_HB_PERIOD}</macro><value>10800</value></macro><macro><macro>{$PD_THROTTLING_HB_PERIOD}</macro><value>10800</value></macro></macros></template></templates></zabbix_export>
