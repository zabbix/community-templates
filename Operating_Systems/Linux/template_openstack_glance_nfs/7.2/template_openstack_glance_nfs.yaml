zabbix_export:
  version: '7.2'
  template_groups:
    - uuid: b77b8890a96043cbacab15f8180a74a6
      name: 'Templates/Operating systems'
  templates:
    - uuid: 51690fa54d47478fba52e1374d8b5dda
      template: 'OpenStack Glance NFS Storage'
      name: 'OpenStack Glance NFS Storage'
      description: |
        Template for monitoring OpenStack Glance NFS storage mounts

        Monitors NFS mount points under /mnt/glance* used by OpenStack Glance image service

        Requirements:
        - Zabbix agent 2 (active mode)
        - Linux OS
        - NFS mounts under /mnt/glance or /mnt/glance-unity

        Metrics:
        - Free space (bytes and percentage)
        - Used space (bytes)
        - Total space (bytes)
        - Inode usage

        Triggers:
        - Critical: < 10% free space
        - Warning: < 20% free space
        - Info: < 30% free space

        Author: Claude Code
        Version: 1.0 (2026-02-12)
      vendor:
        name: 'Community'
        version: '7.2'
      groups:
        - name: 'Templates/Operating systems'
      discovery_rules:
        - uuid: 131aec44daa94248a375577beb307ba5
          name: 'Glance NFS Mount Discovery'
          type: ZABBIX_ACTIVE
          key: 'vfs.fs.discovery'
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#FSTYPE}'
                value: '^nfs4?$'
                formulaid: A
              - macro: '{#FSNAME}'
                value: '^/mnt/glance.*$'
                formulaid: B
          description: 'Discovers NFS mount points used by OpenStack Glance under /mnt/glance*'
          item_prototypes:
            - uuid: 9c6b0cadffa844abbec7b5d2f584f47b
              name: 'Glance NFS [{#FSNAME}]: Free space'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.size[{#FSNAME},free]'
              delay: 5m
              history: 7d
              units: B
              description: 'Free disk space in bytes on {#FSNAME}'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'

            - uuid: b88bedf7383e4d5a97d325b533da0da1
              name: 'Glance NFS [{#FSNAME}]: Free space, %'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.size[{#FSNAME},pfree]'
              delay: 5m
              history: 7d
              value_type: FLOAT
              units: '%'
              description: 'Free disk space in percentage on {#FSNAME}'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'

            - uuid: f47cfee607374396b77f68df50b6faab
              name: 'Glance NFS [{#FSNAME}]: Total space'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.size[{#FSNAME},total]'
              delay: 1h
              history: 7d
              units: B
              description: 'Total disk space in bytes on {#FSNAME}'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'

            - uuid: 965acb315cba4c0dbfca3400990c499f
              name: 'Glance NFS [{#FSNAME}]: Used space'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.size[{#FSNAME},used]'
              delay: 5m
              history: 7d
              units: B
              description: 'Used disk space in bytes on {#FSNAME}'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'

            - uuid: aedfcbd5d7dc4fa09be55f125d90f4f0
              name: 'Glance NFS [{#FSNAME}]: Free inodes, %'
              type: ZABBIX_ACTIVE
              key: 'vfs.fs.inode[{#FSNAME},pfree]'
              delay: 5m
              history: 7d
              value_type: FLOAT
              units: '%'
              description: 'Free inodes in percentage on {#FSNAME}'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'

          trigger_prototypes:
            - uuid: 3d37d0423a0f4770b7e28669a6f3724a
              expression: 'last(/OpenStack Glance NFS Storage/vfs.fs.size[{#FSNAME},pfree])<10'
              name: 'Glance NFS [{#FSNAME}]: Disk space critically low (<10% free)'
              event_name: 'Glance NFS [{#FSNAME}]: Disk space critically low (<{ITEM.VALUE1}% free)'
              priority: HIGH
              description: |
                Glance NFS mount {#FSNAME} has less than 10% free space remaining.
                This may impact the ability to store new OpenStack images.
              tags:
                - tag: scope
                  value: capacity
                - tag: scope
                  value: performance

            - uuid: 7e010be2592841bdac7995000b671ff3
              expression: 'last(/OpenStack Glance NFS Storage/vfs.fs.size[{#FSNAME},pfree])<20'
              name: 'Glance NFS [{#FSNAME}]: Disk space low (<20% free)'
              event_name: 'Glance NFS [{#FSNAME}]: Disk space low (<{ITEM.VALUE1}% free)'
              priority: WARNING
              description: |
                Glance NFS mount {#FSNAME} has less than 20% free space remaining.
                Consider cleaning up old images or expanding storage.
              dependencies:
                - name: 'Glance NFS [{#FSNAME}]: Disk space critically low (<10% free)'
                  expression: 'last(/OpenStack Glance NFS Storage/vfs.fs.size[{#FSNAME},pfree])<10'
              tags:
                - tag: scope
                  value: capacity

            - uuid: 089ea9e3299a4c6094f7f6ca3b4fb2ba
              expression: 'last(/OpenStack Glance NFS Storage/vfs.fs.size[{#FSNAME},pfree])<30'
              name: 'Glance NFS [{#FSNAME}]: Disk space below 30%'
              event_name: 'Glance NFS [{#FSNAME}]: Disk space at {ITEM.VALUE1}%'
              priority: INFO
              description: |
                Glance NFS mount {#FSNAME} has less than 30% free space remaining.
              dependencies:
                - name: 'Glance NFS [{#FSNAME}]: Disk space low (<20% free)'
                  expression: 'last(/OpenStack Glance NFS Storage/vfs.fs.size[{#FSNAME},pfree])<20'
              tags:
                - tag: scope
                  value: capacity

            - uuid: 4ddaffd27ae44fc9aeefb116e3cba651
              expression: 'last(/OpenStack Glance NFS Storage/vfs.fs.inode[{#FSNAME},pfree])<20'
              name: 'Glance NFS [{#FSNAME}]: Inodes critically low (<20% free)'
              event_name: 'Glance NFS [{#FSNAME}]: Inodes critically low (<{ITEM.VALUE1}% free)'
              priority: WARNING
              description: |
                Glance NFS mount {#FSNAME} has less than 20% free inodes remaining.
                This may prevent creating new files even if disk space is available.
              tags:
                - tag: scope
                  value: capacity

          graph_prototypes:
            - uuid: 67cd90debe0f4c60b1c402cfc012fb15
              name: 'Glance NFS [{#FSNAME}]: Disk space usage'
              width: '600'
              height: '340'
              type: PIE
              graph_items:
                - color: 1A7C11
                  calc_fnc: LAST
                  item:
                    host: 'OpenStack Glance NFS Storage'
                    key: 'vfs.fs.size[{#FSNAME},free]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: LAST
                  item:
                    host: 'OpenStack Glance NFS Storage'
                    key: 'vfs.fs.size[{#FSNAME},used]'
