zabbix_export:
  version: '7.4'

  template_groups:
    - uuid: '9017d35422104e71a7ddd5fa32f74c80'
      name: 'Templates/Network devices'

  templates:
    - uuid: 'cc253dec9d63440ab89ca0b08bf4c130'
      template: 'Template Net D-Link DGS-1210 SNMP'
      name: 'Template Net D-Link DGS-1210 SNMP'
      description: >
        D-Link DGS-1210-08P (SNMP v2c). Interfaces discovery, traffic, errors and link status.
        UUIDs are UUIDv4 (hyphens removed), which Zabbix expects on import.
      groups:
        - name: 'Templates/Network devices'

      macros:
        - macro: '{$SNMP_COMMUNITY}'
          type: TEXT
          value: 'public'
          description: 'SNMP v2c community (override per host)'

      items:
        - uuid: '7a5b16e886c94cec8d6c772b892f3628'
          name: 'SNMP: sysUpTime'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.2.1.1.3.0'
          key: 'snmp.sysUpTime'
          delay: 1m
          value_type: FLOAT
          units: uptime
          history: 7d
          trends: 365d

        - uuid: '521c97ee3d284a22b6e9a8dc587aac29'
          name: 'SNMP: sysName'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.2.1.1.5.0'
          key: 'snmp.sysName'
          delay: 5m
          value_type: TEXT
          history: 30d
          trends: 0

        - uuid: '03cfc9d73ef6403a8e98edf5f2f23559'
          name: 'SNMP: sysDescr'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.2.1.1.1.0'
          key: 'snmp.sysDescr'
          delay: 1h
          value_type: TEXT
          history: 30d
          trends: 0

        - uuid: 'dd7623219e0c4fda893b3517859cb0f6'
          name: 'SNMP: sysLocation'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.2.1.1.6.0'
          key: 'snmp.sysLocation'
          delay: 1h
          value_type: TEXT
          history: 30d
          trends: 0

        - uuid: '47a6724ff85840e5a669f6e8436641e1'
          name: 'SNMP: sysObjectID'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.2.1.1.2.0'
          key: 'snmp.sysObjectID'
          delay: 1h
          value_type: TEXT
          history: 30d
          trends: 0

      discovery_rules:
        - uuid: '174df32f43db477aaf1e6e09ede6647b'
          name: 'Network interfaces discovery'
          type: SNMP_AGENT
          key: 'net.if.discovery'
          delay: 10m
          snmp_oid: >
            discovery[{#IFINDEX},1.3.6.1.2.1.2.2.1.1,
            {#IFDESCR},1.3.6.1.2.1.2.2.1.2,
            {#IFTYPE},1.3.6.1.2.1.2.2.1.3,
            {#IFNAME},1.3.6.1.2.1.31.1.1.1.1]

          filter:
            evaltype: AND
            conditions:
              - formulaid: A
                macro: '{#IFDESCR}'
                value: '.*(L2VLAN|rif|CPU).*'
                operator: NOT_MATCHES_REGEX

          item_prototypes:
            - uuid: '87b99544a55d49db9c6fefe256556cb2'
              name: 'Interface {#IFNAME}: Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#IFINDEX}'
              key: 'if.oper.status[{#IFINDEX}]'
              delay: 1m
              value_type: UNSIGNED
              history: 30d
              trends: 365d

            - uuid: '3de2f5afb27245babd4e6a39b2478516'
              name: 'Interface {#IFNAME}: Admin status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.7.{#IFINDEX}'
              key: 'if.admin.status[{#IFINDEX}]'
              delay: 5m
              value_type: UNSIGNED
              history: 30d
              trends: 365d

            - uuid: '15d189a1b62f4b8c9fd174c830ef53cc'
              name: 'Interface {#IFNAME}: Inbound traffic'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.6.{#IFINDEX}'
              key: 'if.in.bps[{#IFINDEX}]'
              delay: 1m
              value_type: FLOAT
              units: bps
              history: 30d
              trends: 365d
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ['8']

            - uuid: '949d5e24877b4f979284d2ee1de22cde'
              name: 'Interface {#IFNAME}: Outbound traffic'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.10.{#IFINDEX}'
              key: 'if.out.bps[{#IFINDEX}]'
              delay: 1m
              value_type: FLOAT
              units: bps
              history: 30d
              trends: 365d
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ['8']

            - uuid: 'f32806ec1a834a548684bdf07e87941b'
              name: 'Interface {#IFNAME}: In errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#IFINDEX}'
              key: 'if.in.errors[{#IFINDEX}]'
              delay: 2m
              value_type: UNSIGNED
              history: 30d
              trends: 365d
              preprocessing:
                - type: CHANGE_PER_SECOND

            - uuid: '3e6eaa1f3aa04b2098c1fce79311cf93'
              name: 'Interface {#IFNAME}: Out errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#IFINDEX}'
              key: 'if.out.errors[{#IFINDEX}]'
              delay: 2m
              value_type: UNSIGNED
              history: 30d
              trends: 365d
              preprocessing:
                - type: CHANGE_PER_SECOND

          trigger_prototypes:
            - uuid: '7823dce1295848f38ec3d7569a38c99d'
              name: 'Interface {#IFNAME}: Link down'
              expression: 'last(/Template Net D-Link DGS-1210 SNMP/if.admin.status[{#IFINDEX}])=1 and last(/Template Net D-Link DGS-1210 SNMP/if.oper.status[{#IFINDEX}])<>1'
              priority: HIGH
              manual_close: 'YES'
