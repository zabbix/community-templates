zabbix_export:
  version: '7.4'
  template_groups:
  - uuid: dd261581137c42cab5ee915e15fc1d60
    name: 'Templates/Power'
  templates:
  - uuid: b17eb6521b064538be603b64ae7e3094
    template: 'Rittal PDU 7979 by SNMP'
    name: 'Rittal PDU 7979 by SNMP'
    description: 'Monitoring template for Rittal PDU 7979 with CMC III controller via SNMPv2. Includes controller (PDU-Controller) health, switched PDU (PDU-SWI) status, electrical measurements (I/U/P/E, cosφ) and socket states.'
    groups:
    - name: 'Templates/Power'
    macros:
    - macro: '{$RITTAL.PDU.DEVIDX}'
      value: '2'
      description: Device index of the PDU-SWI in cmcIIIDevTable/cmcIIIVarTable.
    - macro: '{$RITTAL.PDU.LOADAVG1.WARN}'
      value: '3'
      description: Warning threshold for controller 1 min CPU load average.
    - macro: '{$RITTAL.PDU.LOADAVG1.CRIT}'
      value: '4'
      description: Critical threshold for controller 1 min CPU load average.
    - macro: '{$RITTAL.PDU.FREQ.MIN}'
      value: '49'
      description: Minimum acceptable input frequency for PDU-SWI (Hz).
    - macro: '{$RITTAL.PDU.FREQ.MAX}'
      value: '51'
      description: Maximum acceptable input frequency for PDU-SWI (Hz).
    - macro: '{$RITTAL.PDU.VOLT.LN.MIN}'
      value: '210'
      description: Minimum acceptable line-to-neutral voltage for PDU-SWI (V).
    - macro: '{$RITTAL.PDU.VOLT.LN.MAX}'
      value: '250'
      description: Maximum acceptable line-to-neutral voltage for PDU-SWI (V).
    - macro: '{$RITTAL.PDU.CURRENT.NEUTRAL.MAX}'
      value: '15'
      description: Maximum neutral line current for PDU-SWI (A).
    - macro: '{$RITTAL.PDU.CURRENT.PHASE.WARN}'
      value: '12'
      description: Warning threshold for phase current of PDU-SWI (A).
    - macro: '{$RITTAL.PDU.CURRENT.PHASE.CRIT}'
      value: '14'
      description: Critical threshold for phase current of PDU-SWI (A).
    - macro: '{$RITTAL.PDU.POWER.TOTAL.WARN}'
      value: '3000'
      description: Warning threshold for total active power of PDU-SWI (W).
    - macro: '{$RITTAL.PDU.POWER.TOTAL.CRIT}'
      value: '3400'
      description: Critical threshold for total active power of PDU-SWI (W).
    - macro: '{$RITTAL.PDU.POWER.PHASE.WARN}'
      value: '2500'
      description: Warning threshold for phase active power of PDU-SWI (W).
    - macro: '{$RITTAL.PDU.POWER.PHASE.CRIT}'
      value: '2800'
      description: Critical threshold for phase active power of PDU-SWI (W).
    - macro: '{$RITTAL.PDU.PF.MIN}'
      value: '0.80'
      description: Minimum acceptable power factor cos φ for PDU-SWI.

    items:
    - uuid: e8f53c0c0ae6424ba72ca82090cb43c9
      name: 'PDU-Controller: Unit status'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitStatus.0
      key: cmcIII.unit.status
      value_type: UNSIGNED
      description: '1=ok, 2=failed, 3=overload (cmcIIIUnitStatus).'
      valuemap:
        name: 'PDU-Controller unit status'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: status
      triggers:
      - uuid: cb0f00baa79747a5a32e1a89571240c3
        name: 'PDU-Controller: unit status is not OK'
        expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.unit.status)<>1'
        priority: HIGH
    - uuid: 51a1fa8b33314493aead1d1b475b0a1b
      name: 'PDU-Controller: Serial number'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitSerial.0
      key: cmcIII.unit.serial
      delay: 1h
      value_type: TEXT
      description: 'Serial number of CMCIII PU (cmcIIIUnitSerial).'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: inventory
    - uuid: 95fa6ee1e5834aec9fb575cf53c07681
      name: 'PDU-Controller: Uptime'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitUpTime.0
      key: cmcIII.unit.uptime
      value_type: UNSIGNED
      units: uptime
      description: 'Operating time (cmcIIIUnitUpTime).'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: runtime
    - uuid: b7e36235a6b244a981dab0b2b4a5af9b
      name: 'PDU-Controller: Overall device status'
      type: SNMP_AGENT
      snmp_oid: cmcIIIOverallDevStatus.0
      key: cmcIII.overall.dev.status
      value_type: UNSIGNED
      description: 'Overall status of all devices (cmcIIIOverallDevStatus).'
      valuemap:
        name: 'PDU-Controller overall device status'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: status
      triggers:
      - uuid: b5c805add95a4fc386ef5d5a723b0e8e
        name: 'PDU-Controller: overall device status is not OK'
        expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.overall.dev.status)<>1'
        priority: HIGH
    - uuid: 968e02ff50a049e1a3493fac0f56b714
      name: 'PDU-Controller: Overall message status'
      type: SNMP_AGENT
      snmp_oid: cmcIIIOverallMsgStatus.0
      key: cmcIII.overall.msg.status
      value_type: UNSIGNED
      description: 'Overall message status (cmcIIIOverallMsgStatus).'
      valuemap:
        name: 'PDU-Controller overall message status'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: status
      triggers:
      - uuid: 07f5162f8311433eafd3f7b1f2a4c5d1
        name: 'PDU-Controller: overall message status is not OK'
        expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.overall.msg.status)<>1'
        priority: HIGH
    - uuid: fa14cb93fab44376b193996eebf74212
      name: 'PDU-SWI: Device status (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevStatus.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.status
      value_type: UNSIGNED
      description: 'Status of PDU device in cmcIIIDevTable (cmcIIIDevStatus). 2=ok.'
      valuemap:
        name: 'PDU-Controller device status'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: status
      triggers:
      - uuid: 3e19352b7e9e4582893de7a0bfa5f873
        name: 'PDU controller: device status (Unit {$RITTAL.PDU.DEVIDX}) is not OK'
        expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.status)<>2'
        priority: HIGH
    - uuid: d1e029b0cdbc4da380246938f99f588a
      name: 'PDU-SWI: Device status text (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevStatusText.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.status.text
      value_type: TEXT
      description: 'Latest status text for PDU device (cmcIIIDevStatusText).'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: status-text
    - uuid: 4fc4cd84db0045869ab7e931791b8ddb
      name: 'PDU-Controller: Unit mode'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitMode.0
      key: cmcIII.unit.mode
      value_type: UNSIGNED
      description: 'Current operating mode of the Rittal PDU controller (cmcIIIUnitMode). See value map for textual meaning.'
      valuemap:
        name: 'PDU-Controller unit mode'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: status
        
    # ---------- PDU-Controller: System Health ----------

    - uuid: 0123456789ab4cde8f0123456789abcd
      name: 'PDU-Controller: System health temperature status'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIVarValueStr.1.22'
      key: cmcIII.system.health.temperature.status
      delay: 1m
      history: 7d
      trends: '0'
      value_type: TEXT
      description: 'System Health temperature status of the controller (System Health.Temperature.Status). Typical value: "OK".'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: health
      - tag: subsystem
        value: temperature
      triggers:
      - uuid: a123456789ab4cde8f0123456789abcd
        name: 'PDU-Controller: System health temperature status is not OK'
        expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.system.health.temperature.status)<>"OK"'
        priority: HIGH
        description: 'System Health temperature status is not "OK".'

    - uuid: 1123456789ab4cde8f0123456789abcd
      name: 'PDU-Controller: System health temperature error info'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIVarValueStr.1.21'
      key: cmcIII.system.health.temperature.error
      delay: 1m
      history: 7d
      trends: '0'
      value_type: TEXT
      description: 'System Health temperature error information text (System Health.Temperature.Error Info).'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: health
      - tag: subsystem
        value: temperature

    - uuid: 2123456789ab4cde8f0123456789abcd
      name: 'PDU-Controller: System health current status'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIVarValueStr.1.27'
      key: cmcIII.system.health.current.status
      delay: 1m
      history: 7d
      trends: '0'
      value_type: TEXT
      description: 'System Health current status of the controller (System Health.Current.Status). Typical value: "OK".'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: health
      - tag: subsystem
        value: current
      triggers:
      - uuid: b123456789ab4cde8f0123456789abcd
        name: 'PDU-Controller: System health current status is not OK'
        expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.system.health.current.status)<>"OK"'
        priority: HIGH
        description: 'System Health current status is not "OK".'

    - uuid: 3123456789ab4cde8f0123456789abcd
      name: 'PDU-Controller: System health current error info'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIVarValueStr.1.26'
      key: cmcIII.system.health.current.error
      delay: 1m
      history: 7d
      trends: '0'
      value_type: TEXT
      description: 'System Health current error information text (System Health.Current.Error Info).'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: health
      - tag: subsystem
        value: current

    - uuid: 4123456789ab4cde8f0123456789abcd
      name: 'PDU-Controller: System health supply status'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIVarValueStr.1.31'
      key: cmcIII.system.health.supply.status
      delay: 1m
      history: 7d
      trends: '0'
      value_type: TEXT
      description: 'System Health supply status of the controller (System Health.Supply.Status). Typical value: "OK".'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: health
      - tag: subsystem
        value: supply
      triggers:
      - uuid: c123456789ab4cde8f0123456789abcd
        name: 'PDU-Controller: System health supply status is not OK'
        expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.system.health.supply.status)<>"OK"'
        priority: HIGH
        description: 'System Health supply status is not "OK".'

    - uuid: 5123456789ab4cde8f0123456789abcd
      name: 'PDU-Controller: System health supply error info'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIVarValueStr.1.30'
      key: cmcIII.system.health.supply.error
      delay: 1m
      history: 7d
      trends: '0'
      value_type: TEXT
      description: 'System Health supply error information text (System Health.Supply.Error Info).'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: health
      - tag: subsystem
        value: supply

    # ---------- PDU-Controller: additional parameters ----------

    - uuid: fda4857e46a04047a1f167fab06f7dd4
      name: 'PDU-Controller: Hardware revision'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitHWRev.0
      key: cmcIII.unit.hwrev
      delay: 1h
      value_type: TEXT
      description: 'Hardware revision string of the Rittal PDU controller (cmcIIIUnitHWRev).'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: inventory
    - uuid: 57bde6991c884f858278553cdfe451c7
      name: 'PDU-Controller: Firmware revision'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitFWRev.0
      key: cmcIII.unit.fwrev
      delay: 1h
      value_type: TEXT
      description: 'Firmware revision string of the Rittal PDU controller (cmcIIIUnitFWRev).'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: inventory
    - uuid: a243001679ed4b5caeb9de345fe6221d
      name: 'PDU-Controller: OS revision'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitOSRev.0
      key: cmcIII.unit.osrev
      delay: 1h
      value_type: TEXT
      description: 'Linux OS revision of the Rittal PDU controller (cmcIIIUnitOSRev).'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: inventory
    - uuid: d66a376bb3814950a599ee7da664a56c
      name: 'PDU-Controller: Production code'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitProd.0
      key: cmcIII.unit.prod
      delay: 1h
      value_type: TEXT
      description: 'Production code / article information of the Rittal PDU controller (cmcIIIUnitProd).'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: inventory
    - uuid: c8b6e259134a4d0fab80e7d742a1a050
      name: 'PDU-Controller: Current source'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitCurrentSource.0
      key: cmcIII.unit.current.source
      value_type: UNSIGNED
      description: 'Power supply source of the controller (cmcIIIUnitCurrentSource).'
      valuemap:
        name: 'PDU-Controller unit current source'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: power
    - uuid: 4febfb030a6f4edb9c88ae84e6351528
      name: 'PDU-Controller: CPU load average (1 min)'
      type: SNMP_AGENT
      snmp_oid: cmcIIIUnitLoadAverage.1
      key: cmcIII.unit.load.avg1
      value_type: FLOAT
      description: CPU load average of the controller for the last 1 minute. Raw
        value is load*100 (cmcIIIUnitLoadAverage.1).
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.01'
      tags:
      - tag: role
        value: pdu-controller
      - tag: class
        value: performance
      triggers:
      - uuid: c560b02191844c4aa8ec14d1cf8b3eda
        name: 'PDU-Controller: high CPU load'
        expression: avg(/Rittal PDU 7979 by SNMP/cmcIII.unit.load.avg1,5m)>{$RITTAL.PDU.LOADAVG1.WARN}
        priority: WARNING
        description: Controller 1 min CPU load average is high above {$RITTAL.PDU.LOADAVG1.WARN}.
      - uuid: c560b02191844c4aa8ec14d1cf8b3edb
        name: 'PDU-Controller: critical CPU load'
        expression: avg(/Rittal PDU 7979 by SNMP/cmcIII.unit.load.avg1,5m)>{$RITTAL.PDU.LOADAVG1.CRIT}
        priority: AVERAGE
        description: Controller 1 min CPU load average is critical above {$RITTAL.PDU.LOADAVG1.CRIT}.


    # ---------- PDU-SWI: device information ----------

    - uuid: 7d845b7308614ae482ae237b88e0cc28
      name: 'PDU-SWI: Device name (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevName.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.name
      delay: 1h
      value_type: TEXT
      description: 'Configured device name of the switched PDU (cmcIIIDevName).'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: inventory
    - uuid: 2c7863957e724c8abdafc16721403166
      name: 'PDU-SWI: Device alias (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevAlias.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.alias
      delay: 1h
      value_type: TEXT
      description: 'Configured alias/description of the switched PDU (cmcIIIDevAlias).'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: inventory
    - uuid: e59f590eb80341159424104e64a95501
      name: 'PDU-SWI: Device type OID (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevType.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.type.oid
      delay: 1h
      value_type: TEXT
      description: 'OBJECT IDENTIFIER describing the switched PDU device type (cmcIIIDevType).'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: inventory
    - uuid: e632091bfd884e75ad326aff49d26863
      name: 'PDU-SWI: Device article number (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevArtNr.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.artnr
      delay: 1h
      value_type: TEXT
      description: 'Article number of the switched PDU (cmcIIIDevArtNr).'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: inventory
    - uuid: 8600523e2922407f80b2a1c7a9a237b6
      name: 'PDU-SWI: Device location (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevLocation.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.location
      delay: 1h
      value_type: TEXT
      description: 'Free-text location for the switched PDU device (cmcIIIDevLocation).'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: inventory
    - uuid: 9190c63f6f1640fdbed926a7fbbbff26
      name: 'PDU-SWI: Device firmware revision (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevFW.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.fwrev
      delay: 1h
      value_type: TEXT
      description: 'Firmware revision string of the switched PDU device (cmcIIIDevFW).'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: inventory
    - uuid: 7e805e96ec9c4814abf5403416548609
      name: 'PDU-SWI: Device hardware revision (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevHW.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.hwrev
      delay: 1h
      value_type: TEXT
      description: 'Hardware revision string of the switched PDU device (cmcIIIDevHW).'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: inventory
    - uuid: fc00b54ee18d408ca4e21826941121d7
      name: 'PDU-SWI: Device serial number (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevSerial.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.serial
      delay: 1h
      value_type: TEXT
      description: 'Serial number of the switched PDU device (cmcIIIDevSerial).'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: inventory
    - uuid: f7199b5f371c4f1eba9febd6d4daf943
      name: 'PDU-SWI: Device last change timestamp (Unit {$RITTAL.PDU.DEVIDX})'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIDevLastChange.{$RITTAL.PDU.DEVIDX}'
      key: cmcIII.pdu.lastchange
      delay: 1h
      value_type: UNSIGNED
      description: 'Time (in seconds of controller uptime) of last change for this switched PDU device (cmcIIIDevLastChange).'
      units: s
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: status-change

    # ---------- PDU-SWI: total electrical values ----------

    - uuid: 8cb55c543413489597869984422f01ee
      name: 'PDU-SWI: Total input frequency'
      type: SNMP_AGENT
      snmp_oid: cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.1
      key: cmcIII.pdu.total.freq
      value_type: FLOAT
      description: Total input frequency of the switched PDU (Total.Frequency.Value).
        Raw value is frequency*10.
      units: Hz
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: power
      triggers:
      - uuid: 9586792daf4a4b4daf12bb2541fe86c6
        name: 'PDU-SWI: input frequency out of range'
        expression: (last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.total.freq)<{$RITTAL.PDU.FREQ.MIN})
          or (last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.total.freq)>{$RITTAL.PDU.FREQ.MAX})
        priority: AVERAGE
        description: Total input frequency of the PDU is outside the allowed range
          {$RITTAL.PDU.FREQ.MIN}..{$RITTAL.PDU.FREQ.MAX}.

    - uuid: d960082dc64b496580073d1588eb99aa
      name: 'PDU-SWI: Neutral current'
      type: SNMP_AGENT
      snmp_oid: cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.3
      key: cmcIII.pdu.neutral.current
      value_type: FLOAT
      description: Neutral line current of the switched PDU (Total.Neutral Current.Value).
        Raw value is current*100.
      units: A
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.01'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: current
      triggers:
      - uuid: dde8ee9a2ac546b99207a6c5d0debbfd
        name: 'PDU-SWI: neutral current is high'
        expression: last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.neutral.current)>{$RITTAL.PDU.CURRENT.NEUTRAL.MAX}
        priority: HIGH
        description: Neutral conductor current of the PDU exceeds {$RITTAL.PDU.CURRENT.NEUTRAL.MAX}A.

    - uuid: 86d4a9c27aae44b1b177f96b9b56dc9f
      name: 'PDU-SWI: Total active power'
      type: SNMP_AGENT
      snmp_oid: cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.12
      key: cmcIII.pdu.total.power.active
      value_type: FLOAT
      description: Total active power of the switched PDU (Total.Power.Active.Value).
      units: W
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: power
      triggers:
      - uuid: c545b3e7f27a428792e46f7255057213
        name: 'PDU-SWI: total active power is high'
        expression: last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.total.power.active)>{$RITTAL.PDU.POWER.TOTAL.WARN}
        priority: AVERAGE
        description: Total active power of the PDU is high and exceeds {$RITTAL.PDU.POWER.TOTAL.WARN}W.
      - uuid: c545b3e7f27a428792e46f7255057214
        name: 'PDU-SWI: total active power is critical'
        expression: last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.total.power.active)>{$RITTAL.PDU.POWER.TOTAL.CRIT}
        priority: HIGH
        description: Total active power of the PDU is critical and exceeds {$RITTAL.PDU.POWER.TOTAL.CRIT}W.

    - uuid: 831adb6fff7649c78ceb1a60277399a5
      name: 'PDU-SWI: Total active energy'
      type: SNMP_AGENT
      snmp_oid: 'cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.20'
      key: cmcIII.pdu.total.energy.active
      value_type: FLOAT
      description: 'Total active energy of the switched PDU (Total.Energy.Active.Value). Raw value is energy*10.'
      units: kWh
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      tags:
      - tag: role
        value: pdu-swi
      - tag: class
        value: energy

    discovery_rules:
    
    # ---------- PDU-SWI: socket general status discovery ----------
    
      - uuid: f8afad4f0ca3479593487500b341cbf8
        name: 'PDU-SWI: socket general status discovery'
        type: SNMP_AGENT
        snmp_oid: 'discovery[{#SNMPVALUE},cmcIIIVarName.{$RITTAL.PDU.DEVIDX}]'
        key: cmcIII.pdu.socket.discovery
        delay: 1h
        filter:
          conditions:
            - macro: '{#SNMPVALUE}'
              value: '^Sockets\.Socket [0-9]{2}\.General\.Status$'
              formulaid: A
        preprocessing:
          - type: JAVASCRIPT
            parameters:
              - |
                var d = JSON.parse(value);
                for (var i = 0; i < d.length; i++) {
                    var v = d[i]['{#SNMPVALUE}'] || '';
                    var m = v.match(/Socket (\d{2})/);
                    if (m) {
                        d[i]['{#SOCKET}'] = m[1];   // 01..13
                    } else {
                        d[i]['{#SOCKET}'] = d[i]['{#SNMPINDEX}'];
                    }
                }
                return JSON.stringify(d);
        item_prototypes:
          - uuid: 7e3833f829224325bb5d79c3103c45eb
            name: 'PDU-SWI: Socket {#SOCKET} status'
            type: SNMP_AGENT
            snmp_oid: 'cmcIIIVarValueStr.{$RITTAL.PDU.DEVIDX}.{#SNMPINDEX}'
            key: 'cmcIII.pdu.socket.status[{#SOCKET}]'
            value_type: TEXT
            description: 'Status text of socket {#SOCKET} of the switched PDU (Sockets.Socket NN.General.Status).'
            tags:
              - tag: role
                value: pdu-swi
              - tag: class
                value: status
              - tag: socket
                value: '{#SOCKET}'
              - tag: socket_index
                value: '{#SNMPINDEX}'
        trigger_prototypes:
          - uuid: 9e377c6a5ce74d6bb7af304bbdb938f6
            name: 'PDU-SWI: Socket {#SOCKET} status is not On'
            expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.socket.status[{#SOCKET}])<>"On"'
            priority: HIGH
            description: 'Socket {#SOCKET} general status reported by the switched PDU is not "On".'
          
      # ---------- PDU-SWI: phase voltage (L-N) discovery ----------
      - uuid: 1d5660a2e8b4474cb753818dc61a3262
        name: 'PDU-SWI: Phase voltage (L-N) discovery'
        type: SNMP_AGENT
        snmp_oid: 'discovery[{#SNMPVALUE},cmcIIIVarName.{$RITTAL.PDU.DEVIDX}]'
        key: cmcIII.pdu.phase.voltage.discovery
        delay: 1h
        filter:
          conditions:
            - macro: '{#SNMPVALUE}'
              value: '^Phase L[0-9]+\.Voltage\.Value$'
              formulaid: A
        preprocessing:
          - type: JAVASCRIPT
            parameters:
              - |
                var d = JSON.parse(value);
                for (var i = 0; i < d.length; i++) {
                    var v = d[i]['{#SNMPVALUE}'] || '';
                    var m = v.match(/Phase (L[0-9]+)/);
                    d[i]['{#PHASE}'] = m ? m[1] : 'L1';
                }
                return JSON.stringify(d);
        item_prototypes:
          - uuid: 967f57f6e10d407aa795bce0c8abebd2
            name: 'PDU-SWI: Phase {#PHASE} voltage (L-N)'
            type: SNMP_AGENT
            snmp_oid: 'cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.{#SNMPINDEX}'
            key: 'cmcIII.pdu.phase[{#PHASE},voltage]'
            value_type: FLOAT
            description: 'Phase {#PHASE} line-to-neutral voltage of the switched PDU (Phase Lx.Voltage.Value). Raw value is voltage*10.'
            units: V
            preprocessing:
              - type: MULTIPLIER
                parameters:
                  - '0.1'
            tags:
              - tag: role
                value: pdu-swi
              - tag: class
                value: voltage
              - tag: phase
                value: '{#PHASE}'
        trigger_prototypes:
          - uuid: e83d86ffc1424dfaa6c8135151219fb4
            name: 'PDU-SWI: phase {#PHASE} voltage out of range'
            expression: '(last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.phase[{#PHASE},voltage])<{$RITTAL.PDU.VOLT.LN.MIN}) or (last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.phase[{#PHASE},voltage])>{$RITTAL.PDU.VOLT.LN.MAX})'
            priority: AVERAGE
            description: 'Phase {#PHASE} line-to-neutral voltage is outside the allowed range {$RITTAL.PDU.VOLT.LN.MIN}..{$RITTAL.PDU.VOLT.LN.MAX} V.'


      # ---------- PDU-SWI: phase current discovery ----------
      - uuid: d669a5d63f52436ea1c8b30e130f6995
        name: 'PDU-SWI: Phase current discovery'
        type: SNMP_AGENT
        snmp_oid: 'discovery[{#SNMPVALUE},cmcIIIVarName.{$RITTAL.PDU.DEVIDX}]'
        key: cmcIII.pdu.phase.current.discovery
        delay: 1h
        filter:
          conditions:
            - macro: '{#SNMPVALUE}'
              value: '^Phase L[0-9]+\.Current\.Value$'
              formulaid: A
        preprocessing:
          - type: JAVASCRIPT
            parameters:
              - |
                var d = JSON.parse(value);
                for (var i = 0; i < d.length; i++) {
                    var v = d[i]['{#SNMPVALUE}'] || '';
                    var m = v.match(/Phase (L[0-9]+)/);
                    d[i]['{#PHASE}'] = m ? m[1] : 'L1';
                }
                return JSON.stringify(d);
        item_prototypes:
          - uuid: 8f4bb71fbad244a0bcd8b592872446c1
            name: 'PDU-SWI: Phase {#PHASE} current'
            type: SNMP_AGENT
            snmp_oid: 'cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.{#SNMPINDEX}'
            key: 'cmcIII.pdu.phase[{#PHASE},current]'
            value_type: FLOAT
            description: 'Phase {#PHASE} current of the switched PDU (Phase Lx.Current.Value). Raw value is current*100.'
            units: A
            preprocessing:
              - type: MULTIPLIER
                parameters:
                  - '0.01'
            tags:
              - tag: role
                value: pdu-swi
              - tag: class
                value: current
              - tag: phase
                value: '{#PHASE}'
        trigger_prototypes:
          - uuid: fb1d8caf804c49ff9ab2131bf6a984ca
            name: 'PDU-SWI: phase {#PHASE} current is high'
            expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.phase[{#PHASE},current])>{$RITTAL.PDU.CURRENT.PHASE.WARN}'
            priority: AVERAGE
            description: 'Phase {#PHASE} current of the PDU is high and exceeds {$RITTAL.PDU.CURRENT.PHASE.WARN} A.'
          - uuid: fb1d8caf804c49ff9ab2131bf6a984cb
            name: 'PDU-SWI: phase {#PHASE} current is critical'
            expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.phase[{#PHASE},current])>{$RITTAL.PDU.CURRENT.PHASE.CRIT}'
            priority: HIGH
            description: 'Phase {#PHASE} current of the PDU is critical and exceeds {$RITTAL.PDU.CURRENT.PHASE.CRIT} A.'


      # ---------- PDU-SWI: phase power factor (cos φ) discovery ----------
      - uuid: e81ff3af31ca4de58cd42bc7a6c9759c
        name: 'PDU-SWI: Phase power factor (cos φ) discovery'
        type: SNMP_AGENT
        snmp_oid: 'discovery[{#SNMPVALUE},cmcIIIVarName.{$RITTAL.PDU.DEVIDX}]'
        key: cmcIII.pdu.phase.pf.discovery
        delay: 1h
        filter:
          conditions:
            - macro: '{#SNMPVALUE}'
              value: '^Phase L[0-9]+\.Power\.Factor\.Value$'
              formulaid: A
        preprocessing:
          - type: JAVASCRIPT
            parameters:
              - |
                var d = JSON.parse(value);
                for (var i = 0; i < d.length; i++) {
                    var v = d[i]['{#SNMPVALUE}'] || '';
                    var m = v.match(/Phase (L[0-9]+)/);
                    d[i]['{#PHASE}'] = m ? m[1] : 'L1';
                }
                return JSON.stringify(d);
        item_prototypes:
          - uuid: 9cb0d031f7ae4c3fb9a99c1872fae524
            name: 'PDU-SWI: Phase {#PHASE} power factor (cos φ)'
            type: SNMP_AGENT
            snmp_oid: 'cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.{#SNMPINDEX}'
            key: 'cmcIII.pdu.phase[{#PHASE},power.factor]'
            value_type: FLOAT
            description: 'Phase {#PHASE} power factor cos φ of the switched PDU (Phase Lx.Power.Factor.Value). Raw value is cosφ*100; value range is -1..1.'
            preprocessing:
              - type: MULTIPLIER
                parameters:
                  - '-0.01'
            tags:
              - tag: role
                value: pdu-swi
              - tag: class
                value: power
              - tag: phase
                value: '{#PHASE}'
        trigger_prototypes:
          - uuid: e391888d9237441093e652bc012b1a9e
            name: 'PDU-SWI: phase {#PHASE} power factor is low'
            expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.phase[{#PHASE},power.factor])<{$RITTAL.PDU.PF.MIN}'
            priority: WARNING
            description: 'Phase {#PHASE} power factor cos φ of the PDU is below {$RITTAL.PDU.PF.MIN}.'


      # ---------- PDU-SWI: phase active power discovery ----------
      - uuid: b4c5f7b37dc046179fc315c58e9acf62
        name: 'PDU-SWI: Phase active power discovery'
        type: SNMP_AGENT
        snmp_oid: 'discovery[{#SNMPVALUE},cmcIIIVarName.{$RITTAL.PDU.DEVIDX}]'
        key: cmcIII.pdu.phase.power.active.discovery
        delay: 1h
        filter:
          conditions:
            - macro: '{#SNMPVALUE}'
              value: '^Phase L[0-9]+\.Power\.Active\.Value$'
              formulaid: A
        preprocessing:
          - type: JAVASCRIPT
            parameters:
              - |
                var d = JSON.parse(value);
                for (var i = 0; i < d.length; i++) {
                    var v = d[i]['{#SNMPVALUE}'] || '';
                    var m = v.match(/Phase (L[0-9]+)/);
                    d[i]['{#PHASE}'] = m ? m[1] : 'L1';
                }
                return JSON.stringify(d);
        item_prototypes:
          - uuid: 2b71fbd45d764745b4244af1e37f50d3
            name: 'PDU-SWI: Phase {#PHASE} active power'
            type: SNMP_AGENT
            snmp_oid: 'cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.{#SNMPINDEX}'
            key: 'cmcIII.pdu.phase[{#PHASE},power.active]'
            value_type: FLOAT
            description: 'Phase {#PHASE} active power of the switched PDU (Phase Lx.Power.Active.Value).'
            units: W
            tags:
              - tag: role
                value: pdu-swi
              - tag: class
                value: power
              - tag: phase
                value: '{#PHASE}'
        trigger_prototypes:
          - uuid: 804387a4f67d4d57a44aff87a31b2043
            name: 'PDU-SWI: phase {#PHASE} active power is high'
            expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.phase[{#PHASE},power.active])>{$RITTAL.PDU.POWER.PHASE.WARN}'
            priority: AVERAGE
            description: 'Phase {#PHASE} active power of the PDU is high and exceeds {$RITTAL.PDU.POWER.PHASE.WARN} W.'
          - uuid: 804387a4f67d4d57a44aff87a31b2044
            name: 'PDU-SWI: phase {#PHASE} active power is critical'
            expression: 'last(/Rittal PDU 7979 by SNMP/cmcIII.pdu.phase[{#PHASE},power.active])>{$RITTAL.PDU.POWER.PHASE.CRIT}'
            priority: HIGH
            description: 'Phase {#PHASE} active power of the PDU is critical and exceeds {$RITTAL.PDU.POWER.PHASE.CRIT} W.'


      # ---------- PDU-SWI: phase reactive power discovery ----------
      - uuid: be50b5dbb7244e37ba16b6f5dc374013
        name: 'PDU-SWI: Phase reactive power discovery'
        type: SNMP_AGENT
        snmp_oid: 'discovery[{#SNMPVALUE},cmcIIIVarName.{$RITTAL.PDU.DEVIDX}]'
        key: cmcIII.pdu.phase.power.reactive.discovery
        delay: 1h
        filter:
          conditions:
            - macro: '{#SNMPVALUE}'
              value: '^Phase L[0-9]+\.Power\.Reactive\.Value$'
              formulaid: A
        preprocessing:
          - type: JAVASCRIPT
            parameters:
              - |
                var d = JSON.parse(value);
                for (var i = 0; i < d.length; i++) {
                    var v = d[i]['{#SNMPVALUE}'] || '';
                    var m = v.match(/Phase (L[0-9]+)/);
                    d[i]['{#PHASE}'] = m ? m[1] : 'L1';
                }
                return JSON.stringify(d);
        item_prototypes:
          - uuid: da2bc9fae2074e379ec6d56c11d0b9b0
            name: 'PDU-SWI: Phase {#PHASE} reactive power'
            type: SNMP_AGENT
            snmp_oid: 'cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.{#SNMPINDEX}'
            key: 'cmcIII.pdu.phase[{#PHASE},power.reactive]'
            value_type: FLOAT
            description: 'Phase {#PHASE} reactive power of the switched PDU (Phase Lx.Power.Reactive.Value).'
            units: var
            tags:
              - tag: role
                value: pdu-swi
              - tag: class
                value: power
              - tag: phase
                value: '{#PHASE}'


      # ---------- PDU-SWI: phase apparent power discovery ----------
      - uuid: 6629b4b02e624b3587e1fc1b11068a98
        name: 'PDU-SWI: Phase apparent power discovery'
        type: SNMP_AGENT
        snmp_oid: 'discovery[{#SNMPVALUE},cmcIIIVarName.{$RITTAL.PDU.DEVIDX}]'
        key: cmcIII.pdu.phase.power.apparent.discovery
        delay: 1h
        filter:
          conditions:
            - macro: '{#SNMPVALUE}'
              value: '^Phase L[0-9]+\.Power\.Apparent\.Value$'
              formulaid: A
        preprocessing:
          - type: JAVASCRIPT
            parameters:
              - |
                var d = JSON.parse(value);
                for (var i = 0; i < d.length; i++) {
                    var v = d[i]['{#SNMPVALUE}'] || '';
                    var m = v.match(/Phase (L[0-9]+)/);
                    d[i]['{#PHASE}'] = m ? m[1] : 'L1';
                }
                return JSON.stringify(d);
        item_prototypes:
          - uuid: 163cb294e07243f39727bbb8b119c487
            name: 'PDU-SWI: Phase {#PHASE} apparent power'
            type: SNMP_AGENT
            snmp_oid: 'cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.{#SNMPINDEX}'
            key: 'cmcIII.pdu.phase[{#PHASE},power.apparent]'
            value_type: FLOAT
            description: 'Phase {#PHASE} apparent power of the switched PDU (Phase Lx.Power.Apparent.Value).'
            units: VA
            tags:
              - tag: role
                value: pdu-swi
              - tag: class
                value: power
              - tag: phase
                value: '{#PHASE}'


      # ---------- PDU-SWI: phase active energy discovery ----------
      - uuid: 68315494135b4ee9bb4487d4ded31615
        name: 'PDU-SWI: Phase active energy discovery'
        type: SNMP_AGENT
        snmp_oid: 'discovery[{#SNMPVALUE},cmcIIIVarName.{$RITTAL.PDU.DEVIDX}]'
        key: cmcIII.pdu.phase.energy.active.discovery
        delay: 1h
        filter:
          conditions:
            - macro: '{#SNMPVALUE}'
              value: '^Phase L[0-9]+\.Energy\.Active\.Value$'
              formulaid: A
        preprocessing:
          - type: JAVASCRIPT
            parameters:
              - |
                var d = JSON.parse(value);
                for (var i = 0; i < d.length; i++) {
                    var v = d[i]['{#SNMPVALUE}'] || '';
                    var m = v.match(/Phase (L[0-9]+)/);
                    d[i]['{#PHASE}'] = m ? m[1] : 'L1';
                }
                return JSON.stringify(d);
        item_prototypes:
          - uuid: aae8bb3d5122499f8b01fdef975bfc77
            name: 'PDU-SWI: Phase {#PHASE} active energy'
            type: SNMP_AGENT
            snmp_oid: 'cmcIIIVarValueInt.{$RITTAL.PDU.DEVIDX}.{#SNMPINDEX}'
            key: 'cmcIII.pdu.phase[{#PHASE},energy.active]'
            value_type: FLOAT
            description: 'Phase {#PHASE} active energy of the switched PDU (Phase Lx.Energy.Active.Value). Raw value is energy*10.'
            units: kWh
            preprocessing:
              - type: MULTIPLIER
                parameters:
                  - '0.1'
            tags:
              - tag: role
                value: pdu-swi
              - tag: class
                value: energy
              - tag: phase
                value: '{#PHASE}'

        
    valuemaps:
    - uuid: afa562f1531f4493bc059dae22f0ae3f
      name: 'PDU-Controller unit status'
      mappings:
      - value: '1'
        newvalue: ok
      - value: '2'
        newvalue: failed
      - value: '3'
        newvalue: overload
    - uuid: d7b099f1ecb943c1b7e53956d56d0116
      name: 'PDU-Controller overall device status'
      mappings:
      - value: '1'
        newvalue: ok
      - value: '2'
        newvalue: warning
      - value: '3'
        newvalue: alarm
      - value: '4'
        newvalue: detected
      - value: '5'
        newvalue: lost
      - value: '6'
        newvalue: changed
      - value: '7'
        newvalue: update
    - uuid: 85d6d84277f14ef0a6ed9911400c1979
      name: 'PDU-Controller overall message status'
      mappings:
      - value: '1'
        newvalue: ok
      - value: '2'
        newvalue: warning
      - value: '3'
        newvalue: alarm
    - uuid: d614d7d8587c42d5954b34cfef29c222
      name: 'PDU-Controller device status'
      mappings:
      - value: '1'
        newvalue: notAvail
      - value: '2'
        newvalue: ok
      - value: '3'
        newvalue: detect
      - value: '4'
        newvalue: lost
      - value: '5'
        newvalue: changed
      - value: '6'
        newvalue: error
      - value: '7'
        newvalue: fwUpdate
      - value: '8'
        newvalue: fwUpdateRun
    - uuid: b65f5f6c07e14d39a7f319dc32a9d6c4
      name: 'PDU-Controller unit mode'
      mappings:
      - value: '1'
        newvalue: localInit
      - value: '2'
        newvalue: start
      - value: '3'
        newvalue: pwrDelay
      - value: '4'
        newvalue: restartBus
      - value: '5'
        newvalue: localOnline
      - value: '6'
        newvalue: collectSlaves
      - value: '7'
        newvalue: reorganizeBus
      - value: '8'
        newvalue: online
      - value: '9'
        newvalue: prepareUpgrade
      - value: '10'
        newvalue: upgradeSensor
      - value: '11'
        newvalue: terminate
    - uuid: c5184489fa2a498aa5475952cf19eee6
      name: 'PDU-Controller unit current source'
      mappings:
      - value: '1'
        newvalue: main
      - value: '2'
        newvalue: acAdapter
      - value: '3'
        newvalue: terminalStrip
      - value: '4'
        newvalue: poe
      - value: '5'

        newvalue: usb
