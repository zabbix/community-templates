zabbix_export:
  version: '7.4'
  template_groups:
  - uuid: 1a49382d36274f4b8003c334be77a0f3
    name: Templates/Power
  templates:
  - uuid: 63f301090e564644aad30ee595a32e8d
    template: UPS_CS141_SNMP_RFC1628
    name: UPS_CS141_SNMP_RFC1628
    description: "Piller (and other) UPS with CS141 card, SNMP monitoring via UPS-MIB (RFC1628)."
    groups:
    - name: Templates/Power
    items:
    - uuid: 7a33f15d65e241de99cfa448cbd62c8d
      name: UPS manufacturer
      type: SNMP_AGENT
      key: ups.ident.manufacturer
      snmp_oid: UPS-MIB::upsIdentManufacturer.0
      value_type: TEXT
      delay: 1h
      description: UPS-MIB::upsIdentManufacturer.0 – UPS manufacturer name.
      tags:
      - tag: component
        value: ident
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 58d3d444240344ed9cdac6964aef1b11
      name: UPS model
      type: SNMP_AGENT
      key: ups.ident.model
      snmp_oid: UPS-MIB::upsIdentModel.0
      value_type: TEXT
      delay: 1h
      description: UPS-MIB::upsIdentModel.0 – UPS model designation.
      triggers:
      - uuid: 7bf16f36ccb045479b4875bbcfcaf9a5
        name: UPS model has changed
        expression: >
          last(/UPS_CS141_SNMP_RFC1628/ups.ident.model,#1)
          <>last(/UPS_CS141_SNMP_RFC1628/ups.ident.model,#2)
        priority: INFO
        manual_close: 'YES'
        tags:
        - tag: component
          value: ident
        - tag: scope
          value: change
      tags:
      - tag: component
        value: ident
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 3e4ab3828922447fb0563aae7165cda6
      name: UPS firmware version
      type: SNMP_AGENT
      key: ups.ident.ups_sw_version
      snmp_oid: UPS-MIB::upsIdentUPSSoftwareVersion.0
      value_type: TEXT
      delay: 1h
      description: UPS-MIB::upsIdentUPSSoftwareVersion.0 – UPS main firmware version.
      tags:
      - tag: component
        value: ident
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 1afaf07654c343b397b464baa8839457
      name: UPS agent software version
      type: SNMP_AGENT
      key: ups.ident.agent_sw_version
      snmp_oid: UPS-MIB::upsIdentAgentSoftwareVersion.0
      value_type: TEXT
      delay: 1h
      description: UPS-MIB::upsIdentAgentSoftwareVersion.0 – SNMP/CS141 agent software version.
      tags:
      - tag: component
        value: ident
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: a3470495f6864605af0922788e9ae8cf
      name: UPS name
      type: SNMP_AGENT
      key: ups.ident.name
      snmp_oid: UPS-MIB::upsIdentName.0
      value_type: TEXT
      delay: 1h
      description: UPS-MIB::upsIdentName.0 – UPS name/label.
      tags:
      - tag: component
        value: ident
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 96117bbf3d44451a8e9af37170482cd8
      name: UPS serial number
      type: SNMP_AGENT
      key: ups.ident.serial
      snmp_oid: UPS-MIB::upsSerialNumber.0
      value_type: TEXT
      delay: 1h
      description: UPS-MIB::upsSerialNumber.0 – UPS serial number.
      triggers:
      - uuid: c6c6a0559106490dbf5cb26c9eddd212
        name: UPS serial number has changed
        expression: >
          last(/UPS_CS141_SNMP_RFC1628/ups.ident.serial,#1)
          <>last(/UPS_CS141_SNMP_RFC1628/ups.ident.serial,#2)
        priority: INFO
        manual_close: 'YES'
        tags:
        - tag: component
          value: ident
        - tag: scope
          value: change
      tags:
      - tag: component
        value: ident
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: c19038e35fd940efa3d3741aff8b53f0
      name: UPS location
      type: SNMP_AGENT
      key: ups.ident.location
      snmp_oid: UPS-MIB::upsLocation.0
      value_type: TEXT
      delay: 1h
      description: UPS-MIB::upsLocation.0 – UPS location string.
      tags:
      - tag: component
        value: ident
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 0322a88aa70f4518a6e9e2e2d0687913
      name: UPS system contact
      type: SNMP_AGENT
      key: ups.ident.contact
      snmp_oid: UPS-MIB::upsSystemContact.0
      value_type: TEXT
      delay: 1h
      description: UPS-MIB::upsSystemContact.0 – UPS contact person or group.
      tags:
      - tag: component
        value: ident
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: db2b0f1c117244deace5be8f3d8e2e5e
      name: Output voltage L1
      type: SNMP_AGENT
      key: ups.output.voltage.l1
      snmp_oid: UPS-MIB::upsOutputVoltage.1
      value_type: FLOAT
      units: V
      description: UPS-MIB::upsOutputVoltage.1 – Output voltage L1 (phase-to-neutral, V).
      triggers:
      - uuid: 7441f393b97e4a0aa6013493c1d3bc51
        name: UPS output voltage deviation warning
        expression: >
          abs(last(/UPS_CS141_SNMP_RFC1628/ups.output.voltage.l1)-{$UPS_VOLT_NOMINAL})>{$UPS_OUTPUT_VOLT_WARN_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.output.voltage.l2)-{$UPS_VOLT_NOMINAL})>{$UPS_OUTPUT_VOLT_WARN_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.output.voltage.l3)-{$UPS_VOLT_NOMINAL})>{$UPS_OUTPUT_VOLT_WARN_DEV}
        priority: WARNING
        tags:
        - tag: component
          value: voltage_output
        - tag: scope
          value: voltage
      - uuid: e64346c3b7ed464b82151f592a9301a3
        name: UPS output voltage deviation critical
        expression: >
          abs(last(/UPS_CS141_SNMP_RFC1628/ups.output.voltage.l1)-{$UPS_VOLT_NOMINAL})>{$UPS_OUTPUT_VOLT_CRIT_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.output.voltage.l2)-{$UPS_VOLT_NOMINAL})>{$UPS_OUTPUT_VOLT_CRIT_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.output.voltage.l3)-{$UPS_VOLT_NOMINAL})>{$UPS_OUTPUT_VOLT_CRIT_DEV}
        priority: HIGH
        tags:
        - tag: component
          value: voltage_output
        - tag: scope
          value: voltage
      tags:
      - tag: component
        value: voltage_output
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 63eecaba3cbb4265a331a2cbbf856b38
      name: Output voltage L2
      type: SNMP_AGENT
      key: ups.output.voltage.l2
      snmp_oid: UPS-MIB::upsOutputVoltage.2
      value_type: FLOAT
      units: V
      description: UPS-MIB::upsOutputVoltage.2 – Output voltage L2 (phase-to-neutral, V).
      tags:
      - tag: component
        value: voltage_output
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 46126aa9027c49d39918033dbc0ff3b6
      name: Output voltage L3
      type: SNMP_AGENT
      key: ups.output.voltage.l3
      snmp_oid: UPS-MIB::upsOutputVoltage.3
      value_type: FLOAT
      units: V
      description: UPS-MIB::upsOutputVoltage.3 – Output voltage L3 (phase-to-neutral, V).
      tags:
      - tag: component
        value: voltage_output
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: d54fa0135837409991e9c2a0b3f24032
      name: Output load L1
      type: SNMP_AGENT
      key: ups.output.load.l1
      snmp_oid: UPS-MIB::upsOutputPercentLoad.1
      value_type: FLOAT
      units: '%'
      description: UPS-MIB::upsOutputPercentLoad.1 – Output load L1 (% of nominal).
      triggers:
      - uuid: 2f195be8b97445ab912bf60c43eab346
        name: UPS output load is high (>= {$UPS_LOAD_WARN}%)
        expression: >
          last(/UPS_CS141_SNMP_RFC1628/ups.output.load.l1)>={$UPS_LOAD_WARN}
          or last(/UPS_CS141_SNMP_RFC1628/ups.output.load.l2)>={$UPS_LOAD_WARN}
          or last(/UPS_CS141_SNMP_RFC1628/ups.output.load.l3)>={$UPS_LOAD_WARN}
        priority: WARNING
        tags:
        - tag: component
          value: load
        - tag: scope
          value: capacity
      - uuid: 314fff3fce5e43628bff2b106eb182a8
        name: UPS output load is critical (>= {$UPS_LOAD_CRIT}%)
        expression: >
          last(/UPS_CS141_SNMP_RFC1628/ups.output.load.l1)>={$UPS_LOAD_CRIT}
          or last(/UPS_CS141_SNMP_RFC1628/ups.output.load.l2)>={$UPS_LOAD_CRIT}
          or last(/UPS_CS141_SNMP_RFC1628/ups.output.load.l3)>={$UPS_LOAD_CRIT}
        priority: HIGH
        tags:
        - tag: component
          value: load
        - tag: scope
          value: capacity
      tags:
      - tag: component
        value: load
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 384f99e7ebc54c348245248a0f7e4903
      name: Output load L2
      type: SNMP_AGENT
      key: ups.output.load.l2
      snmp_oid: UPS-MIB::upsOutputPercentLoad.2
      value_type: FLOAT
      units: '%'
      description: UPS-MIB::upsOutputPercentLoad.2 – Output load L2 (% of nominal).
      tags:
      - tag: component
        value: load
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 0c264a4f00c246ca81b23ab72bf4cd72
      name: Output load L3
      type: SNMP_AGENT
      key: ups.output.load.l3
      snmp_oid: UPS-MIB::upsOutputPercentLoad.3
      value_type: FLOAT
      units: '%'
      description: UPS-MIB::upsOutputPercentLoad.3 – Output load L3 (% of nominal).
      tags:
      - tag: component
        value: load
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 4d11c30f5184413ea3e5116c1048930f
      name: Battery capacity
      type: SNMP_AGENT
      key: ups.battery.capacity
      snmp_oid: UPS-MIB::upsEstimatedChargeRemaining.0
      value_type: FLOAT
      units: '%'
      description: UPS-MIB::upsEstimatedChargeRemaining.0 – Estimated remaining battery capacity (%).
      triggers:
      - uuid: 57b25d3edc8c4b7cae70929387848736
        name: UPS battery capacity is low (<= {$UPS_BATT_CAP_WARN}%)
        expression: last(/UPS_CS141_SNMP_RFC1628/ups.battery.capacity)<={$UPS_BATT_CAP_WARN}
        priority: WARNING
        tags:
        - tag: component
          value: battery
        - tag: scope
          value: capacity
      tags:
      - tag: component
        value: battery
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 35c40471a969421aa000f51cda5bdfe8
      name: Input voltage L1
      type: SNMP_AGENT
      key: ups.input.voltage.l1
      snmp_oid: UPS-MIB::upsInputVoltage.1
      value_type: FLOAT
      units: V
      description: UPS-MIB::upsInputVoltage.1 – Input voltage L1 (phase-to-neutral, V).
      triggers:
      - uuid: ed1ff2013b744fc882733af3a5e3c28d
        name: UPS input voltage deviation warning
        expression: >
          abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.voltage.l1)-{$UPS_VOLT_NOMINAL})>{$UPS_INPUT_VOLT_WARN_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.voltage.l2)-{$UPS_VOLT_NOMINAL})>{$UPS_INPUT_VOLT_WARN_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.voltage.l3)-{$UPS_VOLT_NOMINAL})>{$UPS_INPUT_VOLT_WARN_DEV}
        priority: WARNING
        tags:
        - tag: component
          value: voltage_input
        - tag: scope
          value: voltage
      - uuid: c41303c55fb04bae9e35dcc7a1d19c38
        name: UPS input voltage deviation critical
        expression: >
          abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.voltage.l1)-{$UPS_VOLT_NOMINAL})>{$UPS_INPUT_VOLT_CRIT_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.voltage.l2)-{$UPS_VOLT_NOMINAL})>{$UPS_INPUT_VOLT_CRIT_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.voltage.l3)-{$UPS_VOLT_NOMINAL})>{$UPS_INPUT_VOLT_CRIT_DEV}
        priority: HIGH
        tags:
        - tag: component
          value: voltage_input
        - tag: scope
          value: voltage
      tags:
      - tag: component
        value: voltage_input
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: da29f849365343549dc129a789c52807
      name: Input voltage L2
      type: SNMP_AGENT
      key: ups.input.voltage.l2
      snmp_oid: UPS-MIB::upsInputVoltage.2
      value_type: FLOAT
      units: V
      description: UPS-MIB::upsInputVoltage.2 – Input voltage L2 (phase-to-neutral, V).
      tags:
      - tag: component
        value: voltage_input
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: fe0091b085394f61956b3d6e59b60968
      name: Input voltage L3
      type: SNMP_AGENT
      key: ups.input.voltage.l3
      snmp_oid: UPS-MIB::upsInputVoltage.3
      value_type: FLOAT
      units: V
      description: UPS-MIB::upsInputVoltage.3 – Input voltage L3 (phase-to-neutral, V).
      tags:
      - tag: component
        value: voltage_input
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 127b3b44ce194742b5dd15b740d5233e
      name: UPS internal temperature
      type: SNMP_AGENT
      key: ups.internal.temperature
      snmp_oid: UPS-MIB::upsBatteryTemperature.0
      value_type: FLOAT
      units: "°C"
      description: UPS-MIB::upsBatteryTemperature.0 – Battery/UPS internal temperature (°C).
      triggers:
      - uuid: cd1fe742d84342d0b6c7ce97ced7bf40
        name: UPS temperature is high (>= {$UPS_TEMP_MAX}°C)
        expression: last(/UPS_CS141_SNMP_RFC1628/ups.internal.temperature)>=({$UPS_TEMP_MAX})
        priority: HIGH
        tags:
        - tag: component
          value: temperature
        - tag: scope
          value: temperature
      tags:
      - tag: component
        value: temperature
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 55025c350fde44ccabb62693fe8defeb
      name: Remaining runtime
      type: SNMP_AGENT
      key: ups.runtime.remaining
      snmp_oid: UPS-MIB::upsEstimatedMinutesRemaining.0
      value_type: FLOAT
      units: m
      description: UPS-MIB::upsEstimatedMinutesRemaining.0 – Estimated runtime on battery (minutes).
      triggers:
      - uuid: fea2b41011a64f4fb4c6db03b023cd7a
        name: UPS remaining runtime is low (<= {$UPS_RUNTIME_MIN_WARN} min)
        expression: last(/UPS_CS141_SNMP_RFC1628/ups.runtime.remaining)<={$UPS_RUNTIME_MIN_WARN}
        priority: WARNING
        tags:
        - tag: component
          value: runtime
        - tag: scope
          value: capacity
      tags:
      - tag: component
        value: runtime
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 7c786afe6fad4184abb7847154a3c135
      name: UPS status raw
      type: SNMP_AGENT
      key: ups.status.raw
      snmp_oid: UPS-MIB::upsOutputSource.0
      value_type: UNSIGNED
      description: UPS-MIB::upsOutputSource.0 – UPS output source status (enumeration).
      triggers:
      - uuid: 650d2a992c4848b6b9a3dcd24f52c087
        name: No data from UPS SNMP items (10m)
        expression: nodata(/UPS_CS141_SNMP_RFC1628/ups.status.raw,10m)=1
        priority: WARNING
        tags:
        - tag: component
          value: communication
        - tag: scope
          value: communication
      tags:
      - tag: component
        value: status
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 0edb78845da24ecebd22aaaf3e23bc58
      name: Battery voltage
      type: SNMP_AGENT
      key: ups.battery.voltage
      snmp_oid: UPS-MIB::upsBatteryVoltage.0
      value_type: FLOAT
      units: V
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: UPS-MIB::upsBatteryVoltage.0 – Battery voltage (0.1 V units).
      triggers:
      - uuid: 9b7d3c962ab947489a1951d65a26f7ea
        name: UPS battery voltage is out of range
        expression: >
          last(/UPS_CS141_SNMP_RFC1628/ups.battery.voltage)<{$UPS_BATT_VOLT_MIN}
          or last(/UPS_CS141_SNMP_RFC1628/ups.battery.voltage)>{$UPS_BATT_VOLT_MAX}
        priority: HIGH
        tags:
        - tag: component
          value: battery
        - tag: scope
          value: voltage
      tags:
      - tag: component
        value: battery
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 3935c3091ef2449fbdd50cba55b068e9
      name: Input frequency L1
      type: SNMP_AGENT
      key: ups.input.frequency.l1
      snmp_oid: UPS-MIB::upsInputFrequency.1
      value_type: FLOAT
      units: Hz
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: UPS-MIB::upsInputFrequency.1 – Input frequency L1 (0.1 Hz units).
      triggers:
      - uuid: 3dc5ba194d894a808b5db2022ea60aea
        name: UPS input frequency deviation warning
        expression: >
          abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.frequency.l1)-{$UPS_FREQ_NOMINAL})>{$UPS_INPUT_FREQ_WARN_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.frequency.l2)-{$UPS_FREQ_NOMINAL})>{$UPS_INPUT_FREQ_WARN_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.frequency.l3)-{$UPS_FREQ_NOMINAL})>{$UPS_INPUT_FREQ_WARN_DEV}
        priority: WARNING
        tags:
        - tag: component
          value: frequency
        - tag: scope
          value: frequency
      - uuid: 8e8d662181534048bfbcf6c14d002c3c
        name: UPS input frequency deviation critical
        expression: >
          abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.frequency.l1)-{$UPS_FREQ_NOMINAL})>{$UPS_INPUT_FREQ_CRIT_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.frequency.l2)-{$UPS_FREQ_NOMINAL})>{$UPS_INPUT_FREQ_CRIT_DEV}
          or abs(last(/UPS_CS141_SNMP_RFC1628/ups.input.frequency.l3)-{$UPS_FREQ_NOMINAL})>{$UPS_INPUT_FREQ_CRIT_DEV}
        priority: HIGH
        tags:
        - tag: component
          value: frequency
        - tag: scope
          value: frequency
      tags:
      - tag: component
        value: frequency
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: fc023f27cde544aa8c255b5831ba767f
      name: Input frequency L2
      type: SNMP_AGENT
      key: ups.input.frequency.l2
      snmp_oid: UPS-MIB::upsInputFrequency.2
      value_type: FLOAT
      units: Hz
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: UPS-MIB::upsInputFrequency.2 – Input frequency L2 (0.1 Hz units).
      tags:
      - tag: component
        value: frequency
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 81281c51763346a4a0d592ca8b17a7fd
      name: Input frequency L3
      type: SNMP_AGENT
      key: ups.input.frequency.l3
      snmp_oid: UPS-MIB::upsInputFrequency.3
      value_type: FLOAT
      units: Hz
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: UPS-MIB::upsInputFrequency.3 – Input frequency L3 (0.1 Hz units).
      tags:
      - tag: component
        value: frequency
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 4e0da3b2bf1b4a4fa6996d7e18cff141
      name: Powerfail counter
      type: SNMP_AGENT
      key: ups.powerfail.counter
      snmp_oid: UPS-MIB::upsInputLineBads.0
      value_type: UNSIGNED
      delay: 1m
      description: UPS-MIB::upsInputLineBads.0 – Count of input line failures (transfers to battery).
      tags:
      - tag: component
        value: counter
      - tag: template
        value: UPS_CS141_SNMP_RFC1628
        
    - uuid: cf394dc94656454b821bf8cb95f11510
      name: UPS battery status
      type: SNMP_AGENT
      key: ups.battery.status
      snmp_oid: UPS-MIB::upsBatteryStatus.0
      value_type: UNSIGNED
      valuemap:
        name: UPS battery status
      description: >
        UPS-MIB::upsBatteryStatus.0 – battery status:
        1=unknown, 2=normal, 3=low, 4=depleted.
      triggers:
      - uuid: 5b0c2f33484e4824b157681e6c7cd99e
        name: 'UPS battery status: LOW'
        expression: last(/UPS_CS141_SNMP_RFC1628/ups.battery.status)=3
        priority: WARNING
        tags:
        - tag: component
          value: battery
        - tag: scope
          value: status
      - uuid: 3c6c7707c7c6481197645eaf6a1e58c6
        name: 'UPS battery status: DEPLETED'
        expression: last(/UPS_CS141_SNMP_RFC1628/ups.battery.status)=4
        priority: HIGH
        tags:
        - tag: component
          value: battery
        - tag: scope
          value: status
      tags:
      - tag: component
        value: battery
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: a8f0fbde86184195838ddb8bded439a2
      name: Seconds on battery
      type: SNMP_AGENT
      key: ups.battery.seconds_on_battery
      snmp_oid: UPS-MIB::upsSecondsOnBattery.0
      value_type: UNSIGNED
      units: s
      description: >
        UPS-MIB::upsSecondsOnBattery.0 – elapsed time since UPS switched
        to battery power (seconds).
      triggers:
      - uuid: dca24e1dc74844cf80366c297a6607ca
        name: UPS is on battery power (>{$UPS_ON_BAT_SEC_WARN}s)
        expression: >
          last(/UPS_CS141_SNMP_RFC1628/ups.status.raw)=5
          and min(/UPS_CS141_SNMP_RFC1628/ups.battery.seconds_on_battery,5m)>{$UPS_ON_BAT_SEC_WARN}
        priority: WARNING
        tags:
        - tag: component
          value: battery
        - tag: scope
          value: availability
      - uuid: dec6775d7d4240f687f329a8cf1e26d8
        name: UPS is on battery power (>{\$UPS_ON_BAT_SEC_CRIT}s)
        expression: >
          last(/UPS_CS141_SNMP_RFC1628/ups.status.raw)=5
          and min(/UPS_CS141_SNMP_RFC1628/ups.battery.seconds_on_battery,5m)>{$UPS_ON_BAT_SEC_CRIT}
        priority: HIGH
        tags:
        - tag: component
          value: battery
        - tag: scope
          value: availability
      tags:
      - tag: component
        value: battery
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: a0455fe1230d43109ab5fcd7ba82d631
      name: Output current L1
      type: SNMP_AGENT
      key: ups.output.current.l1
      snmp_oid: UPS-MIB::upsOutputCurrent.1
      value_type: FLOAT
      units: A
      description: >
        UPS-MIB::upsOutputCurrent.1 – present output current on L1 (Ampere).
        Note: CS141 фактически отдаёт целые амперы (16,17,...) несмотря
        на "0.1 RMS Amp" в MIB, множитель НЕ применяется.
      tags:
      - tag: component
        value: current_output
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: b5725bd93ee34c0baf01e17e3693a3b0
      name: Output current L2
      type: SNMP_AGENT
      key: ups.output.current.l2
      snmp_oid: UPS-MIB::upsOutputCurrent.2
      value_type: FLOAT
      units: A
      description: UPS-MIB::upsOutputCurrent.2 – present output current on L2 (Ampere).
      tags:
      - tag: component
        value: current_output
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: cb2c2347b23346f99efa4625b6bbacdd
      name: Output current L3
      type: SNMP_AGENT
      key: ups.output.current.l3
      snmp_oid: UPS-MIB::upsOutputCurrent.3
      value_type: FLOAT
      units: A
      description: UPS-MIB::upsOutputCurrent.3 – present output current on L3 (Ampere).
      tags:
      - tag: component
        value: current_output
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 2106da1fbe7243718b966c8c0fd91472
      name: Output power L1
      type: SNMP_AGENT
      key: ups.output.power.l1
      snmp_oid: UPS-MIB::upsOutputPower.1
      value_type: FLOAT
      units: W
      description: UPS-MIB::upsOutputPower.1 – present true output power on L1 (Watts).
      tags:
      - tag: component
        value: power_output
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: ece1b85e253c46f2af5713f1d9b86226
      name: Output power L2
      type: SNMP_AGENT
      key: ups.output.power.l2
      snmp_oid: UPS-MIB::upsOutputPower.2
      value_type: FLOAT
      units: W
      description: UPS-MIB::upsOutputPower.2 – present true output power on L2 (Watts).
      tags:
      - tag: component
        value: power_output
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 3ec22c3d528e4d5d9e25deec33c94fb9
      name: Output power L3
      type: SNMP_AGENT
      key: ups.output.power.l3
      snmp_oid: UPS-MIB::upsOutputPower.3
      value_type: FLOAT
      units: W
      description: UPS-MIB::upsOutputPower.3 – present true output power on L3 (Watts).
      tags:
      - tag: component
        value: power_output
      - tag: template
        value: UPS_CS141_SNMP_RFC1628
        
    - uuid: e3f28f1229184a38a4c44264e52390d8
      name: UPS active alarms count
      type: SNMP_AGENT
      key: ups.alarms.present
      snmp_oid: UPS-MIB::upsAlarmsPresent.0
      value_type: UNSIGNED
      description: UPS-MIB::upsAlarmsPresent.0 – number of active alarm conditions (rows in upsAlarmTable).
      triggers:
      - uuid: 2ba58ab005ee446f90dd2c30d9d6547d
        name: UPS has active alarms (>= {$UPS_ALARMS_WARN})
        expression: last(/UPS_CS141_SNMP_RFC1628/ups.alarms.present)>={$UPS_ALARMS_WARN}
        priority: WARNING
        tags:
        - tag: component
          value: alarm
        - tag: scope
          value: status
      - uuid: dc9f99df33054964a1a28617068a674b
        name: UPS has many active alarms (>= {$UPS_ALARMS_CRIT})
        expression: last(/UPS_CS141_SNMP_RFC1628/ups.alarms.present)>={$UPS_ALARMS_CRIT}
        priority: HIGH
        tags:
        - tag: component
          value: alarm
        - tag: scope
          value: status
      tags:
      - tag: component
        value: alarm
      - tag: template
        value: UPS_CS141_SNMP_RFC1628
        
    - uuid: 0864d012058a4a6facff210cf6b838de
      name: AUX Port 1 state
      type: SNMP_AGENT
      key: ups.aux.port1.state
      snmp_oid: UPS-MIB::auxPort1.0
      value_type: UNSIGNED
      valuemap:
        name: UPS AUX port state
      description: 'UPS-MIB::auxPort1.0 – digital input AUX Port 1 (0=off, 1=on).'
      triggers:
      - uuid: 7f42ac0c3f2e434b85c63e0fb7d26652
        name: 'UPS AUX Port 1 active'
        expression: 'last(/UPS_CS141_SNMP_RFC1628/ups.aux.port1.state)=1'
        priority: WARNING
        tags:
        - tag: component
          value: aux
        - tag: scope
          value: status
      tags:
      - tag: component
        value: aux
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 9452b9a48d414fd283c906b8ba494793
      name: AUX Port 2 state
      type: SNMP_AGENT
      key: ups.aux.port2.state
      snmp_oid: UPS-MIB::auxPort2.0
      value_type: UNSIGNED
      valuemap:
        name: UPS AUX port state
      description: 'UPS-MIB::auxPort2.0 – digital input AUX Port 2 (0=off, 1=on).'
      triggers:
      - uuid: 2856a5b4786248e1b6fffdb659410018
        name: 'UPS AUX Port 2 active'
        expression: 'last(/UPS_CS141_SNMP_RFC1628/ups.aux.port2.state)=1'
        priority: WARNING
        tags:
        - tag: component
          value: aux
        - tag: scope
          value: status
      tags:
      - tag: component
        value: aux
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: b58c8b37fce74c688276d00acb3479f2
      name: AUX Port 3 state
      type: SNMP_AGENT
      key: ups.aux.port3.state
      snmp_oid: UPS-MIB::auxPort3.0
      value_type: UNSIGNED
      valuemap:
        name: UPS AUX port state
      description: 'UPS-MIB::auxPort3.0 – digital input AUX Port 3 (0=off, 1=on).'
      triggers:
      - uuid: 03260b8667f341af9f5987bca57107ac
        name: 'UPS AUX Port 3 active'
        expression: 'last(/UPS_CS141_SNMP_RFC1628/ups.aux.port3.state)=1'
        priority: WARNING
        tags:
        - tag: component
          value: aux
        - tag: scope
          value: status
      tags:
      - tag: component
        value: aux
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 8a58b145e0b148f7a2b7539344d82a7d
      name: AUX Port 4 state
      type: SNMP_AGENT
      key: ups.aux.port4.state
      snmp_oid: UPS-MIB::auxPort4.0
      value_type: UNSIGNED
      valuemap:
        name: UPS AUX port state
      description: 'UPS-MIB::auxPort4.0 – digital input AUX Port 4 (0=off, 1=on).'
      triggers:
      - uuid: 639829e3c0f8410780263421dee522bb
        name: 'UPS AUX Port 4 active'
        expression: 'last(/UPS_CS141_SNMP_RFC1628/ups.aux.port4.state)=1'
        priority: WARNING
        tags:
        - tag: component
          value: aux
        - tag: scope
          value: status
      tags:
      - tag: component
        value: aux
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 49ab902868f2449b9358f60717c58afe
      name: 'Sensormanager/SMTCOM sensor 1'
      type: SNMP_AGENT
      key: ups.sensorman.sensor1
      snmp_oid: UPS-MIB::sensorMan1Value.0
      value_type: FLOAT
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: 'UPS-MIB::sensorMan1Value.0 – SensorManager value 1 (0.1 units).'
      tags:
      - tag: component
        value: sensorman
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: fa2276996eb04444bc34fdb07e379ab4
      name: 'Sensormanager/SMTCOM sensor 2'
      type: SNMP_AGENT
      key: ups.sensorman.sensor2
      snmp_oid: UPS-MIB::sensorMan2Value.0
      value_type: FLOAT
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: 'UPS-MIB::sensorMan2Value.0 – SensorManager value 2 (0.1 units).'
      tags:
      - tag: component
        value: sensorman
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 9550fbc51cf9466aa69f627e330cfe0b
      name: 'Sensormanager sensor 3'
      type: SNMP_AGENT
      key: ups.sensorman.sensor3
      snmp_oid: UPS-MIB::sensorMan3Value.0
      value_type: FLOAT
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: 'UPS-MIB::sensorMan3Value.0 – SensorManager value 3 (0.1 units).'
      tags:
      - tag: component
        value: sensorman
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: e1c09167b1f64522b7dd5cc29fe9f1a6
      name: 'Sensormanager sensor 4'
      type: SNMP_AGENT
      key: ups.sensorman.sensor4
      snmp_oid: UPS-MIB::sensorMan4Value.0
      value_type: FLOAT
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: 'UPS-MIB::sensorMan4Value.0 – SensorManager value 4 (0.1 units).'
      tags:
      - tag: component
        value: sensorman
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 75cc75e54b614f66a7f9dd3b28bc435b
      name: 'Sensormanager sensor 5'
      type: SNMP_AGENT
      key: ups.sensorman.sensor5
      snmp_oid: UPS-MIB::sensorMan5Value.0
      value_type: FLOAT
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: 'UPS-MIB::sensorMan5Value.0 – SensorManager value 5 (0.1 units).'
      tags:
      - tag: component
        value: sensorman
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: bc16c0e5fd06454f89027b7991332dee
      name: 'Sensormanager sensor 6'
      type: SNMP_AGENT
      key: ups.sensorman.sensor6
      snmp_oid: UPS-MIB::sensorMan6Value.0
      value_type: FLOAT
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: 'UPS-MIB::sensorMan6Value.0 – SensorManager value 6 (0.1 units).'
      tags:
      - tag: component
        value: sensorman
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 59c825466f7c45db9ab607a04d0d589b
      name: 'Sensormanager sensor 7'
      type: SNMP_AGENT
      key: ups.sensorman.sensor7
      snmp_oid: UPS-MIB::sensorMan7Value.0
      value_type: FLOAT
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: 'UPS-MIB::sensorMan7Value.0 – SensorManager value 7 (0.1 units).'
      tags:
      - tag: component
        value: sensorman
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 2b70de79db164f799a6991e43b50f2ae
      name: 'Sensormanager sensor 8'
      type: SNMP_AGENT
      key: ups.sensorman.sensor8
      snmp_oid: UPS-MIB::sensorMan8Value.0
      value_type: FLOAT
      preprocessing:
      - type: MULTIPLIER
        parameters:
        - '0.1'
      description: 'UPS-MIB::sensorMan8Value.0 – SensorManager value 8 (0.1 units).'
      tags:
      - tag: component
        value: sensorman
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 4b8b2a6a0a154b2a8a6b3e377f8dbf1c
      name: 'UPS alarm descriptor [1]'
      type: SNMP_AGENT
      key: ups.alarm.descr.1
      snmp_oid: UPS-MIB::upsAlarmDescr.1
      value_type: TEXT
      delay: 30s
      history: 7d
      trends: '0'
      description: 'UPS-MIB::upsAlarmDescr.1 – alarm descriptor for index 1.'
      tags:
      - tag: component
        value: alarm
      - tag: template
        value: UPS_CS141_SNMP_RFC1628

    - uuid: 9e50d2a7c3f3403e83e374e0e6c5b9c2
      name: 'Alarm: Battery too old (SNMP)'
      type: CALCULATED
      key: ups.alarm.battery_too_old
      value_type: UNSIGNED
      units: ''
      delay: 30s
      params: >
        last(//ups.alarm.descr.1)="UPS-MIB::upsAlarmBatteryTooOld"
      description: >
        Virtual alarm flag: 1 if upsAlarmDescr.1 equals
        "UPS-MIB::upsAlarmBatteryTooOld", 0 otherwise.
      tags:
      - tag: component
        value: battery
      - tag: template
        value: UPS_CS141_SNMP_RFC1628
      valuemap:
        name: UPS alarm state (SNMP)
      triggers:
      - uuid: 5b4f47a3b5f44f4f9f1347d2a1b9f4da
        name: 'UPS alarm: Battery too old'
        expression: 'last(//ups.alarm.battery_too_old)=1'
        priority: WARNING
        tags:
        - tag: component
          value: battery
        - tag: scope
          value: state

    discovery_rules:
    - uuid: 4869a336dbf343e7af65a02d7a8bfb55
      name: UPS alarms discovery
      type: SNMP_AGENT
      key: ups.alarms.discovery
      snmp_oid: 'discovery[{#UPS_ALARM_ID},UPS-MIB::upsAlarmId,{#UPS_ALARM_DESCR},UPS-MIB::upsAlarmDescr]'
      description: >
        Discover active UPS alarms from UPS-MIB::upsAlarmTable.
        Each row corresponds to one active alarm condition.
#      item_prototypes:
#      - uuid: 4edc4cf9888b4a6a8fea54dea5b7d8de
#        name: 'UPS alarm desc [{#UPS_ALARM_ID}]'
#        type: SNMP_AGENT
#        key: 'ups.alarm.descr[{#UPS_ALARM_ID}]'
#        snmp_oid: 'UPS-MIB::upsAlarmDescr.{#SNMPINDEX}'
#        value_type: TEXT
#        description: >
#          UPS-MIB::upsAlarmDescr.{#SNMPINDEX} – autonomous type that references
#          a well-known alarm OID (for example UPS-MIB::upsAlarmOnBattery, upsAlarmLowBattery, etc.).
#        tags:
#        - tag: component
#          value: alarm
#        - tag: template
#          value: UPS_CS141_SNMP_RFC1628
#      trigger_prototypes:
#      - uuid: c4dafe9819f04346834fa60909a1f9f6
#        name: 'UPS alarm active: {#UPS_ALARM_DESCR} ({#UPS_ALARM_ID})'
#        expression: >
#          last(/UPS_CS141_SNMP_RFC1628/ups.alarm.descr[{#UPS_ALARM_ID}])<>""
#        priority: WARNING
#        tags:
#        - tag: component
#          value: alarm
#        - tag: alarm
#          value: generic

    macros:
    - macro: '{$UPS_VOLT_NOMINAL}'
      value: '230'
      description: 'Nominal phase voltage (used for input/output deviation checks).'
    - macro: '{$UPS_INPUT_VOLT_WARN_DEV}'
      value: '10'
      description: 'Input voltage warning deviation from nominal (V).'
    - macro: '{$UPS_INPUT_VOLT_CRIT_DEV}'
      value: '20'
      description: 'Input voltage critical deviation from nominal (V).'
    - macro: '{$UPS_OUTPUT_VOLT_WARN_DEV}'
      value: '10'
      description: 'Output voltage warning deviation from nominal (V).'
    - macro: '{$UPS_OUTPUT_VOLT_CRIT_DEV}'
      value: '20'
      description: 'Output voltage critical deviation from nominal (V).'
    - macro: '{$UPS_FREQ_NOMINAL}'
      value: '50'
      description: 'Nominal input frequency (used for frequency deviation checks).'
    - macro: '{$UPS_INPUT_FREQ_WARN_DEV}'
      value: '2'
      description: 'Input frequency warning deviation from nominal (Hz).'
    - macro: '{$UPS_INPUT_FREQ_CRIT_DEV}'
      value: '3'
      description: 'Input frequency critical deviation from nominal (Hz).'
    - macro: '{$UPS_TEMP_MAX}'
      value: '40'
      description: 'Max allowed UPS internal temperature in °C.'
    - macro: '{$UPS_BATT_CAP_WARN}'
      value: '30'
      description: 'Warning threshold for battery capacity (%).'
    - macro: '{$UPS_RUNTIME_MIN_WARN}'
      value: '10'
      description: 'Warning threshold for minimal allowed runtime (minutes).'
    - macro: '{$UPS_LOAD_WARN}'
      value: '85'
      description: 'High load threshold per phase (%).'
    - macro: '{$UPS_LOAD_CRIT}'
      value: '95'
      description: 'Critical overload threshold per phase (%).'
    - macro: '{$UPS_BATT_VOLT_MIN}'
      value: '220'
      description: 'Minimal allowed battery voltage (V).'
    - macro: '{$UPS_BATT_VOLT_MAX}'
      value: '300'
      description: 'Maximal allowed battery voltage (V).'
    - macro: '{$UPS_ON_BAT_SEC_WARN}'
      value: '60'
      description: 'Time on battery before warning (seconds).'
    - macro: '{$UPS_ON_BAT_SEC_CRIT}'
      value: '300'
      description: 'Time on battery before critical alert (seconds).'
    - macro: '{$UPS_ALARMS_WARN}'
      value: '2'
      description: 'Warning threshold for minimal allowed warnings.'
    - macro: '{$UPS_ALARMS_CRIT}'
      value: '3'
      description: 'Warning threshold for minimal allowed warnings.'
      
    tags:
    - tag: class
      value: ups
    - tag: protocol
      value: snmp
    - tag: type
      value: cs141

    valuemaps:
    - uuid: 45d39e446242495ea5476027257c4c84
      name: UPS battery status
      mappings:
      - value: '1'
        newvalue: Unknown
      - value: '2'
        newvalue: Normal
      - value: '3'
        newvalue: Low
      - value: '4'
        newvalue: Depleted
    - uuid: a790bae2632c4979b1599b8cf2415b94
      name: UPS AUX port state
      mappings:
      - value: '0'
        newvalue: OK
      - value: '1'
        newvalue: Active
    - uuid: 0340b9d9dac14010bf1bfc894faf1a2e
      name: UPS alarm state (SNMP)
      mappings:
      - value: '0'
        newvalue: OK
      - value: '1'
        newvalue: Alarm