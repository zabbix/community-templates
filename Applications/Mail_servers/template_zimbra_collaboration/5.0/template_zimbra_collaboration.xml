<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>5.0</version><date>2021-11-21T21:57:56Z</date><groups><group><name>Templates</name></group></groups><templates><template><template>Zimbra</template><name>Zimbra</name><description>## Overview

É necessário habilitar o Allow root e o comando externo.


Coleta status dos serviços, fila e spam.


Adicionar ao Userparameter 


 UserParameter=zimbra.mailq,/opt/zimbra/common/sbin/mailq | grep -v &quot;Mail queue is empty&quot; | grep -c '^[0-9A-Z]'


UserParameter=zimbra.service.status,su - zimbra -c&quot;zmcontrol status&quot; &gt; /tmp/zimbrastatus.txt


UserParameter=zimbra.amavis.status,awk '/amavis/{print $2}' /tmp/zimbrastatus.txt


UserParameter=zimbra.antispam.status,awk '/antispam/{print $2}' /tmp/zimbrastatus.txt


UserParameter=zimbra.antivirus.status,awk '/antivirus/{print $2}' /tmp/zimbrastatus.txt


UserParameter=zimbra.cbpolicyd.status,awk '/cbpolicyd/{print $2}' /tmp/zimbrastatus.txt


UserParameter=zimbra.mailbox.status,awk '/mailbox/{print $2}' /tmp/zimbrastatus.txt


UserParameter=zimbra.mta.status,awk '/mta/{print $2}' /tmp/zimbrastatus.txt


UserParameter=zimbra.zmconfigd.status,awk '/zmconfigd/{print $2}' /tmp/zimbrastatus.txt


UserParameter=zimbra.webmail.status,awk '/service webapp/{print $3}' /tmp/zimbrastatus.txt


UserParameter=zimbra.webadm.status,awk '/zimbraAdmin/{print $3}' /tmp/zimbrastatus.txt


UserParameter=zimbra.proxy.status,awk '/proxy/{print $2}' /tmp/zimbrastatus.txt


UserParameter=zimbra.mailq.active,/opt/zimbra/libexec/zmqstat | grep active | cut -d= -f2


UserParameter=zimbra.mailq.corrupt,/opt/zimbra/libexec/zmqstat | grep corrupt | cut -d= -f2


UserParameter=zimbra.mailq.hold,/opt/zimbra/libexec/zmqstat | grep hold | cut -d= -f2


UserParameter=zimbra.mailq.deferred,/opt/zimbra/libexec/zmqstat | grep deferred | cut -d= -f2


UserParameter=zimbra.mailq.incoming,/opt/zimbra/libexec/zmqstat | grep incoming | cut -d= -f2



## Author

Carlos Eduardo

</description><groups><group><name>Templates</name></group></groups><applications><application><name>Anti Spam</name></application><application><name>E-mail</name></application><application><name>Erro</name></application><application><name>postifx</name></application><application><name>Zimbra</name></application></applications><items><item><name>Mail Report</name><key>system.run[/opt/zimbra/libexec/zmdailyreport &gt; /tmp/report.txt]</key><delay>0;h23m40</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><description>Gera o relatório para análise do servidor de e-mails.</description><applications><application><name>Zimbra</name></application></applications></item><item><name>Bloqueio Lista b.barracudacentral.org</name><key>system.run[awk '/blocked using b.barracudacentral.org/{print $5}' /tmp/report.txt]</key><delay>0;h23m50</delay><description>Retorna quantidade de e-mails diários bloqueados pela lista b.barracudacentral.org.</description><applications><application><name>Anti Spam</name></application></applications><preprocessing><step><type>TRIM</type><params>)</params></step></preprocessing></item><item><name>Bloqueio Lista bl.spamcop.net</name><key>system.run[awk '/blocked using bl.spamcop.net/{print $5}' /tmp/report.txt]</key><delay>0;h23m50</delay><description>Retorna quantidade de e-mails diários bloqueados pela lista bl.spamcop.net.</description><applications><application><name>Anti Spam</name></application></applications><preprocessing><step><type>TRIM</type><params>)</params></step></preprocessing></item><item><name>Bloqueio Lista dbl.spamhaus.org</name><key>system.run[awk '/blocked using dbl.spamhaus.org/{print $5}' /tmp/report.txt]</key><delay>0;h23m50</delay><description>Retorna quantidade de e-mails diários bloqueados pela lista dbl.spamhaus.org</description><applications><application><name>Anti Spam</name></application></applications><preprocessing><step><type>TRIM</type><params>)</params></step></preprocessing></item><item><name>Bloqueio Lista psbl.surriel.com</name><key>system.run[awk '/blocked using psbl.surriel.com/{print $5}' /tmp/report.txt]</key><delay>0;h23m50</delay><description>Retorna quantidade de e-mails diários bloqueados pela lista psbl.surriel.com.</description><applications><application><name>Anti Spam</name></application></applications><preprocessing><step><type>TRIM</type><params>)</params></step></preprocessing></item><item><name>Bloqueio Lista zen.spamhaus.org</name><key>system.run[awk '/blocked using zen.spamhaus.org/{print $5}' /tmp/report.txt]</key><delay>0;h23m50</delay><description>Retorna quantidade de e-mails diários bloqueados pela lista zen.spamhaus.org</description><applications><application><name>Anti Spam</name></application></applications><preprocessing><step><type>TRIM</type><params>)</params></step></preprocessing></item><item><name>Tamanho em Mega, dos e-mails enviados</name><key>system.run[awk '/bytes delivered/{print $1}' /tmp/report.txt]</key><delay>0;h23m50</delay><units>B</units><applications><application><name>E-mail</name></application></applications><preprocessing><step><type>RTRIM</type><params>m</params></step><step><type>MULTIPLIER</type><params>1000000</params></step></preprocessing></item><item><name>Tamanho em Mega, dos e-mails recebidos</name><key>system.run[awk '/bytes received/{print $1}' /tmp/report.txt]</key><delay>0;h23m50</delay><units>B</units><applications><application><name>E-mail</name></application></applications><preprocessing><step><type>RTRIM</type><params>m</params></step><step><type>MULTIPLIER</type><params>1000000</params></step></preprocessing></item><item><name>E-mails rejeitados pelo comando Helo - Host não encontrado</name><key>system.run[awk '/Helo command rejected: Host not found/{print $8}' /tmp/report.txt]</key><delay>0;h23m50</delay><description>Retorna quantidade de e-mails diários bloqueados por erro por comando Helo, pelo motivo de host não encontrado.</description><applications><application><name>Erro</name></application></applications><preprocessing><step><type>RTRIM</type><params>)</params></step></preprocessing></item><item><name>E-mails rejeitados pelo comando Helo - Host não qualificado</name><key>system.run[awk '/Helo command rejected: need fully-qualified hostname/{print $8}' /tmp/report.txt]</key><delay>0;h23m50</delay><description>Retorna quantidade de e-mails diários bloqueados por erro por comando Helo, pelo motivo de need fully-qualified hostname.</description><applications><application><name>Erro</name></application></applications><preprocessing><step><type>RTRIM</type><params>)</params></step></preprocessing></item><item><name>E-mails rejeitados</name><key>system.run[awk '/rejected/{print $1}' /tmp/report.txt]</key><delay>0;h23m50</delay><status>DISABLED</status><description>Retorna quantidade de e-mails diários bloqueados por erro no reverso</description><applications><application><name>Anti Spam</name></application></applications><preprocessing><step><type>RTRIM</type><params>)</params></step><step><type>RTRIM</type><params>time</params></step></preprocessing></item><item><name>Bloqueio de e-mail por inconsistência no reverso</name><key>system.run[awk '/reverse hostname/{print $7}' /tmp/report.txt]</key><delay>0;h23m50</delay><description>Retorna quantidade de e-mails diários bloqueados por erro no reverso</description><applications><application><name>Anti Spam</name></application></applications><preprocessing><step><type>TRIM</type><params>)</params></step></preprocessing></item><item><name>Status Amavis Zimbra</name><key>zimbra.amavis.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço Amavis Parado</name><priority>HIGH</priority></trigger></triggers></item><item><name>Status AntiSpam Zimbra</name><key>zimbra.antispam.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço AntiSpam Parado</name><priority>HIGH</priority></trigger></triggers></item><item><name>Status Antivírus Zimbra</name><key>zimbra.antivirus.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço Antivírus Parado</name><priority>HIGH</priority></trigger></triggers></item><item><name>Status Cbpolicyd Zimbra</name><key>zimbra.cbpolicyd.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço Cbpolicyd Parado</name><priority>HIGH</priority></trigger></triggers></item><item><name>Status Mailbox Zimbra</name><key>zimbra.mailbox.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço Mailbox Parado</name><priority>HIGH</priority></trigger></triggers></item><item><name>Fila de e-mail geral</name><key>zimbra.mailq</key><delay>30s</delay><history>1w</history><applications><application><name>postifx</name></application></applications><triggers><trigger><expression>{avg(5m)}&gt;1300</expression><name>Sua fila de email precisa de sua atenção em {HOST.NAME}</name><priority>WARNING</priority></trigger></triggers></item><item><name>Fila de e-mail ativa</name><key>zimbra.mailq.active</key><history>180d</history><description>Quando as mensagens estão na fila, prontas para serem enviadas.</description><applications><application><name>Zimbra</name></application></applications><triggers><trigger><expression>{avg(5m)}&gt;50</expression><name>Envio incomum de e-mails  detectado em {HOST.NAME}</name><priority>HIGH</priority></trigger></triggers></item><item><name>Fila de e-mails corrompido</name><key>zimbra.mailq.corrupt</key><history>180d</history><description>Quando a mensagem se encontra corrompida ou danificada.</description><applications><application><name>Zimbra</name></application></applications></item><item><name>Fila de e-mails não entregues</name><key>zimbra.mailq.deferred</key><history>180d</history><description>Quando as mensagens não podem ser entregues, são colocadas nessa fila para que seja feita uma nova tentativa de reenvio. A quantidade de tentativas de reenvio vai depender da configuração do servidor</description><applications><application><name>Zimbra</name></application></applications></item><item><name>Fila de e-mails não processados</name><key>zimbra.mailq.hold</key><history>180d</history><description>Quando as mensagens não podem mais ser processadas pelo servidor ficaram nesta fila, ate que o administrador altere-as.</description><applications><application><name>Zimbra</name></application></applications></item><item><name>Fila de e-mails entregues</name><key>zimbra.mailq.incoming</key><history>180d</history><description>Quando o e-mail é entregue na caixa do usuário com sucesso.</description><applications><application><name>Zimbra</name></application></applications></item><item><name>Status MTA Zimbra</name><key>zimbra.mta.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço MTA Parado</name><priority>HIGH</priority></trigger></triggers></item><item><name>Status Proxy Zimbra</name><key>zimbra.proxy.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço Proxy Parado</name><priority>HIGH</priority></trigger></triggers></item><item><name>Zimbra Status</name><key>zimbra.service.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications></item><item><name>Status Admin Console Zimbra</name><key>zimbra.webadm.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço Admin Console Parado</name><priority>HIGH</priority></trigger></triggers></item><item><name>Status Serviço Webmail Zimbra</name><key>zimbra.webmail.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço Webmail Parado</name><priority>HIGH</priority></trigger></triggers></item><item><name>Status Zmconfigd Zimbra</name><key>zimbra.zmconfigd.status</key><delay>3m</delay><history>180d</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zimbra</name></application></applications><preprocessing><step><type>REGEX</type><params>Running
0</params><error_handler>CUSTOM_VALUE</error_handler><error_handler_params>1</error_handler_params></step></preprocessing><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>Serviço Zmconfigd Parado</name><priority>HIGH</priority></trigger></triggers></item></items></template></templates><graphs><graph><name>Anti Spam</name><graph_items><graph_item><color>1A7C11</color><item><host>Zimbra</host><key>system.run[awk '/reverse hostname/{print $7}' /tmp/report.txt]</key></item></graph_item><graph_item><sortorder>1</sortorder><color>F63100</color><item><host>Zimbra</host><key>system.run[awk '/blocked using b.barracudacentral.org/{print $5}' /tmp/report.txt]</key></item></graph_item><graph_item><sortorder>2</sortorder><color>2774A4</color><item><host>Zimbra</host><key>system.run[awk '/blocked using bl.spamcop.net/{print $5}' /tmp/report.txt]</key></item></graph_item><graph_item><sortorder>3</sortorder><color>A54F10</color><item><host>Zimbra</host><key>system.run[awk '/blocked using zen.spamhaus.org/{print $5}' /tmp/report.txt]</key></item></graph_item><graph_item><sortorder>4</sortorder><color>FC6EA3</color><item><host>Zimbra</host><key>system.run[awk '/blocked using dbl.spamhaus.org/{print $5}' /tmp/report.txt]</key></item></graph_item><graph_item><sortorder>5</sortorder><color>6C59DC</color><item><host>Zimbra</host><key>system.run[awk '/blocked using psbl.surriel.com/{print $5}' /tmp/report.txt]</key></item></graph_item><graph_item><sortorder>6</sortorder><color>AC8C14</color><item><host>Zimbra</host><key>system.run[awk '/Helo command rejected: need fully-qualified hostname/{print $8}' /tmp/report.txt]</key></item></graph_item></graph_items></graph><graph><name>Evolução da fila de emails</name><show_triggers>NO</show_triggers><graph_items><graph_item><color>1A7C11</color><item><host>Zimbra</host><key>zimbra.mailq.active</key></item></graph_item><graph_item><sortorder>1</sortorder><color>000000</color><item><host>Zimbra</host><key>zimbra.mailq.corrupt</key></item></graph_item><graph_item><sortorder>2</sortorder><color>FF0000</color><item><host>Zimbra</host><key>zimbra.mailq.deferred</key></item></graph_item><graph_item><sortorder>3</sortorder><color>26A69A</color><item><host>Zimbra</host><key>zimbra.mailq.hold</key></item></graph_item><graph_item><sortorder>4</sortorder><color>0040FF</color><item><host>Zimbra</host><key>zimbra.mailq.incoming</key></item></graph_item></graph_items></graph><graph><name>Fila de E-mail</name><graph_items><graph_item><color>1A7C11</color><item><host>Zimbra</host><key>zimbra.mailq</key></item></graph_item></graph_items></graph></graphs></zabbix_export>
