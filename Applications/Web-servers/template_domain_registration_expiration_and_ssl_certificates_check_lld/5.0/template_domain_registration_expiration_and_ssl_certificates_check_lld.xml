<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>5.0</version><date>2021-11-21T21:47:16Z</date><groups><group><name>Templates</name></group></groups><templates><template><template>SSL check LLD</template><name>SSL check LLD</name><description>## Overview

Main idea is monitoring several URL with SSL in one Zabbix host. Data for LLD provide JSON file.


This is originally based on [https://share.zabbix.com/cat-app/web-servers/ssl-certificates-check](cat-app/web-servers/ssl-certificates-check) with modifications to the script and template.


Added domain registration expiration check



</description><groups><group><name>Templates</name></group></groups><applications><application><name>Domain checks</name></application><application><name>HTTPS Service</name></application><application><name>SSL Checks</name></application></applications><discovery_rules><discovery_rule><name>Domains discovery</name><type>EXTERNAL</type><key>list.sh[&quot;ssl_check.json&quot;,&quot;1&quot;]</key><delay>1h</delay><lifetime>60d</lifetime><item_prototypes><item_prototype><name>Domain {#DOMAIN_NAME} expire in</name><type>EXTERNAL</type><key>whois_expire.sh[{#DOMAIN_NAME}]</key><delay>1d</delay><trends>730d</trends><units>day(s)</units><applications><application><name>Domain checks</name></application></applications><trigger_prototypes><trigger_prototype><expression>{last()}&lt;=0</expression><name>Domain {#DOMAIN_NAME} expired</name><priority>DISASTER</priority></trigger_prototype><trigger_prototype><expression>{last()}&lt;14</expression><name>Domain {#DOMAIN_NAME} will expire in 14 days</name><priority>HIGH</priority><dependencies><dependency><name>Domain {#DOMAIN_NAME} expired</name><expression>{SSL check LLD:whois_expire.sh[{#DOMAIN_NAME}].last()}&lt;=0</expression></dependency></dependencies></trigger_prototype><trigger_prototype><expression>{last()}&lt;30</expression><name>Domain {#DOMAIN_NAME} will expire in 30 days</name><priority>WARNING</priority><dependencies><dependency><name>Domain {#DOMAIN_NAME} will expire in 14 days</name><expression>{SSL check LLD:whois_expire.sh[{#DOMAIN_NAME}].last()}&lt;14</expression></dependency></dependencies></trigger_prototype></trigger_prototypes></item_prototype></item_prototypes><lld_macro_paths><lld_macro_path><lld_macro>{#DOMAIN_NAME}</lld_macro><path>$.d_name</path></lld_macro_path></lld_macro_paths><preprocessing><step><type>JAVASCRIPT</type><params>var urls = JSON.parse(value);
var dom_names = [];
for (var i = 0; i &lt; urls.length; i++) {
    var j = urls[i].url.split('.');
    var dn = j[j.length - 2] + '.' + j[j.length - 1];
    if (dom_names.indexOf(dn) == -1) {
        dom_names.push(dn);
    }
}
var dnames = [];
for (var i = 0; i &lt; dom_names.length; i++) {
    dnames.push({'d_name': dom_names[i]});
}
return JSON.stringify(dnames);</params></step></preprocessing></discovery_rule><discovery_rule><name>URLs discovery</name><type>EXTERNAL</type><key>list.sh[&quot;ssl_check.json&quot;]</key><delay>1h</delay><lifetime>60d</lifetime><item_prototypes><item_prototype><name>HTTPS Service on {#URL}:{#PORT} is running</name><type>SIMPLE</type><key>net.tcp.service[https,{#URL},{#PORT}]</key><delay>5m</delay><history>10d</history><trends>730d</trends><applications><application><name>HTTPS Service</name></application></applications><valuemap><name>Service state</name></valuemap><trigger_prototypes><trigger_prototype><expression>{max(#3)}=0</expression><name>HTTPS service is down on {#URL}:{#PORT}</name><priority>AVERAGE</priority><description>Last value: {ITEM.LASTVALUE1}.&#13;
HTTPS service is down on {#URL}:{#PORT}</description></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>SSL certificate validity {#URL}:{#PORT}</name><type>EXTERNAL</type><key>zext_ssl_cert.sh[-d,{#URL},{#PORT}]</key><delay>1h</delay><history>10d</history><trends>730d</trends><units>day(s)</units><applications><application><name>SSL Checks</name></application></applications><trigger_prototypes><trigger_prototype><expression>{nodata(210m)}=1</expression><name>Falied to establish SSL connectoin on {#URL}:{#PORT} in last 3 hour</name><status>DISABLED</status><priority>HIGH</priority></trigger_prototype><trigger_prototype><expression>{last()}&lt;0</expression><name>SSL certificate on {#URL}:{#PORT} expired</name><priority>DISASTER</priority></trigger_prototype><trigger_prototype><expression>{last()}&lt;7</expression><name>SSL certificate on {#URL}:{#PORT} expires in less than 7 days</name><priority>HIGH</priority><description>Last value: {ITEM.LASTVALUE1}.&#13;
SSL certificate on {#URL}:{#PORT} expires in less than week</description><dependencies><dependency><name>SSL certificate on {#URL}:{#PORT} expired</name><expression>{SSL check LLD:zext_ssl_cert.sh[-d,{#URL},{#PORT}].last()}&lt;0</expression></dependency></dependencies></trigger_prototype><trigger_prototype><expression>{last()}&lt;21</expression><name>SSL certificate on {#URL}:{#PORT} expires in less than 21 days</name><priority>WARNING</priority><description>Last value: {ITEM.LASTVALUE1}.&#13;
SSL certificate on {#URL}:{#PORT} expires in less than 3 week</description><dependencies><dependency><name>SSL certificate on {#URL}:{#PORT} expires in less than 7 days</name><expression>{SSL check LLD:zext_ssl_cert.sh[-d,{#URL},{#PORT}].last()}&lt;7</expression></dependency></dependencies></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>SSL certificate issuer {#URL}:{#PORT}</name><type>EXTERNAL</type><key>zext_ssl_cert.sh[-i,{#URL},{#PORT}]</key><delay>1h</delay><history>10d</history><trends>0</trends><value_type>CHAR</value_type><applications><application><name>SSL Checks</name></application></applications></item_prototype></item_prototypes><lld_macro_paths><lld_macro_path><lld_macro>{#PORT}</lld_macro><path>$.port</path></lld_macro_path><lld_macro_path><lld_macro>{#URL}</lld_macro><path>$.url</path></lld_macro_path></lld_macro_paths></discovery_rule></discovery_rules></template></templates><value_maps><value_map><name>Service state</name><mappings><mapping><value>0</value><newvalue>Down</newvalue></mapping><mapping><value>1</value><newvalue>Up</newvalue></mapping></mappings></value_map></value_maps></zabbix_export>
